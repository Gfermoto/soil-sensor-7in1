# üì¶ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è OTA-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π v2.7.0 –¥–ª—è –ø—Ä–æ—à–∏–≤–∫–∏ JXCT

**–ê–≤—Ç–æ—Ä:** –í–µ–¥—É—â–∏–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞  
**–î–∞—Ç–∞:** 2025-06-18  
**–í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å v2.6.0:**

1. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã UI –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π —Ä–∞–∑–¥–µ–ª `spiffs_web`; –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Å—Ç–∞–ª–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º.  
2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑–¥–µ–ª–æ–≤ –¥–ª—è –º–æ–¥—É–ª–µ–π 4 MB –∏ 8 MB (WROOM/WROVER).  
3. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç OTA-–±–∞–Ω–¥–ª–∞ `.jota` (JXCT OTA) c –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π GPG-–ø–æ–¥–ø–∏—Å—å—é –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞.  
4. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∫–∞—Ç–∞ —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏—Ç —Å—á—ë—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –≤ NVS, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É.

---

## 1. üéØ –¶–µ–ª–∏ –∏ KPI (v2.7.0)
| # | –¶–µ–ª—å | KPI / –º–µ—Ç—Ä–∏–∫–∞ |
|---|------|---------------|
| 1 | –ù–∞–¥—ë–∂–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —è–¥—Ä–∞ + UI | ÏÑ±Í≥µ > 99 % –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ |
| 2 | GPG-–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–ª–∏–∑–æ–≤ | –ü–æ–¥–ø–∏—Å—å –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –¥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –±–∏–Ω–∞—Ä–µ–π |
| 3 | –ì–æ—Ä—è—á–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π | 1√ó –≤ —Å—É—Ç–∫–∏, MQTT topic `/jxct/ota/available` |
| 4 | OTA-–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—ã –¥–ª—è UI | –†–∞–∑–º–µ—Ä –ø–∞—Ç—á–∞ < 500 KB |
| 5 | –ú–µ—Ç—Ä–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π | Prometheus: `ota_success_total`, `ota_rollback_total` |

---

## 2. üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è v2.7.0)
1. **`ota_manager.cpp`** –¥–æ–ø–æ–ª–Ω–µ–Ω –ø–æ–¥—Ç–∏–ø–∞–º–∏ –æ–ø–µ—Ä–∞—Ü–∏–π: *Firmware*, *Web*, *Firmware+Web*.
2. **`ota_service.cpp`** —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç endpoint `/ota/changelog` (Markdown-—Å—Ç—Ä–æ–∫–∞ —Ä–µ–ª–∏–∑–∞).
3. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—â–∏–π —Å–∫—Ä–∏–ø—Ç `scripts/build_ota_bundle.py` —Å –æ–ø—Ü–∏–µ–π `--target esp32-{wroom|wrover}`.
4. –§–∞–π–ª `.jota` = Tar + zstd; –≤–Ω—É—Ç—Ä–∏ `manifest.json`, `firmware.bin`, `web_spiffs.bin` (–æ–ø—Ü.).
5. –î–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ < 4 MB —Ä–∞–∑–¥–µ–ª *Web* —É—Ä–µ–∑–∞–µ—Ç—Å—è –¥–æ 1 MB, —É–±–∏—Ä–∞—è source-map –∏ dev-assets.

---

## 3. üìë –¢–∞–±–ª–∏—Ü—ã —Ä–∞–∑–¥–µ–ª–æ–≤ Flash
### 3.1 ESP32-WROOM-32 (4 MB)
| –†–∞–∑–¥–µ–ª | –¢–∏–ø | –ê–¥—Ä–µ—Å | –†–∞–∑–º–µ—Ä |
|--------|-----|-------|--------|
| `nvs`         | Data | 0x9000   | 20 kB |
| `otadata`     | Data | 0xE000   | 8 kB |
| `app0`        | App  | 0x10000  | 1.2 MB |
| `app1`        | App  | 0x140000 | 1.2 MB |
| `spiffs_web`  | Data | 0x280000 | 1.4 MB |

### 3.2 ESP32-WROVER (8 MB)
| –†–∞–∑–¥–µ–ª | –¢–∏–ø | –ê–¥—Ä–µ—Å | –†–∞–∑–º–µ—Ä |
|--------|-----|-------|--------|
| `nvs`         | Data | 0x9000   | 20 kB |
| `otadata`     | Data | 0xE000   | 8 kB |
| `app0`        | App  | 0x10000  | 2 MB |
| `app1`        | App  | 0x210000 | 2 MB |
| `spiffs_web`  | Data | 0x420000 | 3 MB |

---

## 4. üîÑ –°—Ü–µ–Ω–∞—Ä–∏–∏ OTA (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π API)
*–õ–æ–≥–∏–∫–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–∞ v2.6.0, –Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ DIFF-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.*

---

## 5. ‚úÖ –ü–ª–∞–Ω –∑–∞–¥–∞—á –∏ —Å—Ä–æ–∫–∏
| ‚Ññ | –ó–∞–¥–∞—á–∞ | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π | –î–ª–∏—Ç. | –°—Ä–æ–∫ |
|---|--------|--------------|-------|------|
| 1 | –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ñ–æ—Ä–º–∞—Ç–∞ `.jota` | FW-Eng | 1 –¥ | 24-–∏—é–Ω |
| 2 | –î–æ–±–∞–≤–∏—Ç—å GPG-–≤–∞–ª–∏–¥–∞—Ü–∏—é | FW-Eng | 0.5 –¥ | 25-–∏—é–Ω |
| 3 | –ü–∞—Ç—á-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI (zstd-diff) | UI-Dev | 1 –¥ | 26-–∏—é–Ω |
| 4 | –ú–µ—Ç—Ä–∏–∫–∏ Prometheus –≤ `ota_manager` | FW-Eng | 0.5 –¥ | 27-–∏—é–Ω |
| 5 | QA-—Ç–µ—Å—Ç 4/8 MB —É—Å—Ç—Ä–æ–π—Å—Ç–≤ | QA | 1 –¥ | 28-–∏—é–Ω |
| 6 | –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é + —Å–∫—Ä–∏–Ω—à–æ—Ç—ã UI | Tech-Writer | 0.5 –¥ | 29-–∏—é–Ω |

---

## 6. ‚ö†Ô∏è –ö–ª—é—á–µ–≤—ã–µ —Ä–∏—Å–∫–∏
| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω. | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥a—Ü–∏—è |
|------|----------|---------|-----------|
| –û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∏ | –Ω–∏–∑–∫ | –≤—ã—Å | –ü—Ä–µ—Ä–≤–∞—Ç—å OTA –¥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è, –ª–æ–≥ + MQTT alert |
| –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ `spiffs_web` –Ω–∞ 4 MB –≤–µ—Ä—Å–∏—è—Ö | —Å—Ä–µ–¥–Ω | —Å—Ä | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∏—Å—Ç–∏—Ç—å dev-assets –≤ —Ä–µ–ª–∏–∑–µ |

---

> –î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ—à–∏–≤–∫–∏ 2.7.0. –ü—Ä–µ–¥—ã–¥—É—â–∏–π –ø–ª–∞–Ω v2.6.0 —Å–æ—Ö—Ä–∞–Ω—ë–Ω –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏. 