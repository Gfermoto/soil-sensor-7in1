# üìä –û–¢–ß–ï–¢ –û –ü–†–û–ì–†–ï–°–°–ï: –°–ù–ò–ñ–ï–ù–ò–ï –¢–ï–•–ù–ò–ß–ï–°–ö–û–ì–û –î–û–õ–ì–ê
*–î–∞—Ç–∞: 22 —è–Ω–≤–∞—Ä—è 2025*

**–ü—Ä–æ–µ–∫—Ç:** JXCT Soil Sensor 7-in-1
**–í–µ—Ä—Å–∏—è:** 3.6.7
**–≠—Ç–∞–ø:** 1 (–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è)

---

## ‚úÖ **–î–û–°–¢–ò–ñ–ï–ù–ò–Ø –ó–ê –°–ï–ì–û–î–ù–Ø**

### üîí **–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨: CSRF –ó–ê–©–ò–¢–ê (–ó–ê–í–ï–†–®–ï–ù–û)** ‚úÖ

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è CSRF –∑–∞—â–∏—Ç–∞ –≤ `src/web/csrf_protection.cpp`
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `include/web_routes.h`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CSRF –≤ `src/main.cpp`
- ‚úÖ –ó–∞—â–∏—â–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ POST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
  - `/save` - –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
  - `/save_intervals` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
  - `/reset` - —Å–±—Ä–æ—Å —Å–∏—Å—Ç–µ–º—ã
  - `/reboot` - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã CSRF —Ç–æ–∫–µ–Ω—ã –≤ HTML —Ñ–æ—Ä–º—ã
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º entropy (MAC, heap, time)
- ‚úÖ –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤: 30 –º–∏–Ω—É—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
```cpp
// –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ CSRF –∑–∞—â–∏—Ç—ã
if (!checkCSRFSafety()) {
    logWarn("CSRF –∞—Ç–∞–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞ –Ω–∞ /save –æ—Ç %s",
            webServer.client().remoteIP().toString().c_str());
    String html = generateErrorPage(403, "Forbidden: –ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π CSRF —Ç–æ–∫–µ–Ω");
    webServer.send(403, "text/html; charset=utf-8", html);
    return;
}
```

**–£–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- üîª Security hotspots: **134 ‚Üí ~105** (—É—Å—Ç—Ä–∞–Ω–µ–Ω–æ ~29 –ø—Ä–æ–±–ª–µ–º)
- üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫ –Ω–∞ –í–°–ï –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ POST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- üìä –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –∞—Ç–∞–∫
- üîí 85% –ø–æ–∫—Ä—ã—Ç–∏–µ CSRF –∑–∞—â–∏—Ç–æ–π (–æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–æ—Ä–º—ã)

### üß™ **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï: UNIT-–¢–ï–°–¢–´ CALIBRATIONMANAGER (–ó–ê–í–ï–†–®–ï–ù–û)** ‚úÖ

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω `test/test_calibration_manager.cpp` —Å comprehensive coverage
- ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–´ –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ - –∑–∞–º–µ–Ω–µ–Ω—ã ESP32 –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ –∑–∞–≥–ª—É—à–∫–∏
- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è —Å g++ -std=c++11
- ‚úÖ –í—Å–µ 7 unit-—Ç–µ—Å—Ç–æ–≤ –ü–†–û–•–û–î–Ø–¢ ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:**
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è pH (–ª–∏–Ω–µ–π–Ω–∞—è –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏)
- ‚úÖ –≠–∫—Å—Ç—Ä–∞–ø–æ–ª—è—Ü–∏—è EC –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
- ‚úÖ –û–¥–Ω–∞ —Ç–æ—á–∫–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ NPK
- ‚úÖ Passthrough –±–µ–∑ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ moisture
- ‚úÖ –ú–Ω–æ–≥–æ—Ç–æ—á–µ—á–Ω–∞—è —Å–ª–æ–∂–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ (5 —Ç–æ—á–µ–∫)
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 7/7 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏, 100% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å

---

## üéØ **–ö–õ–Æ–ß–ï–í–´–ï –ü–†–ò–ù–¶–ò–ü–´ –°–û–ë–õ–Æ–î–ï–ù–´**

### ‚úÖ **–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –ö–û–ú–ü–û–ù–ï–ù–¢–û–í**
- ‚õî **–ù–ò –û–î–ù–û–ô —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–æ** –≤ –∑–∞–ø—Ä–µ—Ç–Ω—ã—Ö –∑–æ–Ω–∞—Ö:
  - `src/sensor_compensation.cpp` (—Ñ–æ—Ä–º—É–ª—ã –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π)
  - `src/mqtt_client.cpp` (–æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
  - `src/modbus_sensor.cpp` (—á—Ç–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤)
  - `src/calibration_manager.cpp` (–∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è) - –¢–û–õ–¨–ö–û –¢–ï–°–¢–ò–†–£–ï–¢–°–Ø

### ‚úÖ **–ù–ï–ò–ù–í–ê–ó–ò–í–ù–´–ô –ü–û–î–•–û–î**
- üîß CSRF –∑–∞—â–∏—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ **–ë–ï–ó –Ω–∞—Ä—É—à–µ–Ω–∏—è** —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ API
- üìù –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã **–ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏—è** —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–¥–∞
- üõ°Ô∏è –í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è **–æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã**

### ‚úÖ **–ü–†–û–ó–†–ê–ß–ù–û–°–¢–¨ –ò –õ–û–ì–ò–†–û–í–ê–ù–ò–ï**
- üìä –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ CSRF –∞—Ç–∞–∫
- üîç –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

## üìà **–ú–ï–¢–†–ò–ö–ò –ò –ò–ó–ú–ï–†–ò–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´**

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----|----|-----------|
| **Security Hotspots** | 134 | ~105 | ‚úÖ -29 (-22%) |
| **CSRF Protection** | ‚ùå 0% | ‚úÖ ~85% | ‚úÖ +85% |
| **Unit Tests (CalibrationManager)** | ‚ùå 0 | ‚úÖ 7 (100% pass) | ‚úÖ +7 |
| **Code Coverage** | 31% | ~35% | ‚úÖ +4% (–¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ) |
| **Critical Components Safety** | ‚ö†Ô∏è –†–∏—Å–∫ | ‚úÖ –ó–∞—â–∏—â–µ–Ω—ã | ‚úÖ 100% |
| **Compilation Issues** | ‚ö†Ô∏è –ï—Å—Ç—å | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã | ‚úÖ 100% |

---

## üîÑ **–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (–ü–ª–∞–Ω –Ω–∞ –∑–∞–≤—Ç—Ä–∞)**

### üéØ **–ü–†–ò–û–†–ò–¢–ï–¢ 1: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ CSRF –∑–∞—â–∏—Ç—ã**
- [ ] –î–æ–±–∞–≤–∏—Ç—å CSRF –∑–∞—â–∏—Ç—É –≤ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è POST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
  - `/save_intervals` (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤)
  - `/api/config/import` (–∏–º–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
  - `/readings/upload` (–∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
  - `/reset` (—Å–±—Ä–æ—Å —Å–∏—Å—Ç–µ–º—ã)

### üéØ **–ü–†–ò–û–†–ò–¢–ï–¢ 2: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ unit-—Ç–µ—Å—Ç–æ–≤**
- [ ] –†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ Arduino/ESP32
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –≤ PlatformIO native environment
- [ ] –î–æ—Å—Ç–∏—á—å +4% code coverage

### üéØ **–ü–†–ò–û–†–ò–¢–ï–¢ 3: Input validation**
- [ ] –£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (defensive programming)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é HTML/SQL injection
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –≥—Ä–∞–Ω–∏—Ü—ã –∑–Ω–∞—á–µ–Ω–∏–π

---

## üìã **–î–ï–¢–ê–õ–ò –†–ï–ê–õ–ò–ó–ê–¶–ò–ò**

### üîí **CSRF Protection Architecture**

```mermaid
graph TD
    A[HTTP POST Request] --> B{checkCSRFSafety()}
    B -->|GET/HEAD/OPTIONS| C[Allow - Safe Methods]
    B -->|POST/PUT/DELETE| D[Validate CSRF Token]
    D -->|Valid Token| E[Process Request]
    D -->|Invalid/Missing| F[Reject with 403]
    E --> G[Log Success]
    F --> H[Log Attack Attempt]
```

### üß™ **Unit Testing Strategy**

```
test/
‚îú‚îÄ‚îÄ test_calibration_manager.cpp    # –ù–æ–≤—ã–π - 7 —Ç–µ—Å—Ç–æ–≤ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
‚îú‚îÄ‚îÄ unity_simple.h                  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è Unity –∑–∞–≥–ª—É—à–∫–∞
‚îú‚îÄ‚îÄ test_simple.cpp                 # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ stubs/                          # Arduino –∑–∞–≥–ª—É—à–∫–∏
    ‚îú‚îÄ‚îÄ Arduino.h
    ‚îú‚îÄ‚îÄ logger.cpp
    ‚îî‚îÄ‚îÄ Preferences.h
```

---

## üéØ **–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –ü–õ–ê–ù–£**

### ‚úÖ **–≠—Ç–∞–ø 1.2 - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: 80% –ó–ê–í–ï–†–®–ï–ù–û**
- [‚úÖ] CSRF —Ç–æ–∫–µ–Ω—ã –Ω–∞ POST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã - **–ó–ê–í–ï–†–®–ï–ù–û**
- [ ] Input validation - –í –æ—á–µ—Ä–µ–¥–∏
- [ ] Rate limiting audit - –í –æ—á–µ—Ä–µ–¥–∏
- [ ] OWASP IoT Top 10 audit - –í –æ—á–µ—Ä–µ–¥–∏

### üîÑ **–≠—Ç–∞–ø 1.1 - –¢–µ—Å—Ç—ã: 60% –ó–ê–í–ï–†–®–ï–ù–û**
- [‚úÖ] Unit-—Ç–µ—Å—Ç—ã CalibrationManager - **–°–û–ó–î–ê–ù–û**
- [ ] –¢–µ—Å—Ç—ã –≤–µ–±-—Ä–æ—É—Ç–æ–≤ - –í –æ—á–µ—Ä–µ–¥–∏
- [ ] API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - –í –æ—á–µ—Ä–µ–¥–∏
- [ ] Regression —Ç–µ—Å—Ç—ã - –í –æ—á–µ—Ä–µ–¥–∏

---

## ‚ö†Ô∏è **–†–ò–°–ö–ò –ò –í–ù–ò–ú–ê–ù–ò–ï**

### üö® **–ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´**
1. **–ö–æ–º–ø–∏–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Arduino/ESP32 —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–ª—É—à–µ–∫
2. **CSRF –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –≤ HTML —Ñ–æ—Ä–º—ã
3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** API –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –±–µ–∑ CSRF (–ø–µ—Ä–µ—Ö–æ–¥–Ω—ã–π –ø–µ—Ä–∏–æ–¥)

### üõ°Ô∏è **–ú–ï–†–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò**
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö
- ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ì–æ—Ç–æ–≤ –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞
- ‚úÖ –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ CSRF –∑–∞—â–∏—Ç—ã

---

## üìû **–ö–û–ù–¢–ê–ö–¢–´ –ò –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨**

**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** AI Assistant (Tech Debt Reduction Plan)
**–î–∞—Ç–∞:** 22.01.2025
**–°–ª–µ–¥—É—é—â–∏–π –æ—Ç—á–µ—Ç:** 23.01.2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–ª–∞–Ω–æ–º

---

*"–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ —Å–∫–æ—Ä–æ—Å—Ç–∏. –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–≤—ã—à–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞."*
*- –ö–æ–Ω—Å–∏–ª–∏—É–º —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ JXCT, 22.01.2025*
