# QA-отчёт: JXCT Soil Sensor (ESP32, PlatformIO)

## 1. Функциональность

- **Опрос датчика:**  
  - Поддерживается как реальный, так и фейковый датчик (структура SensorData едина для обоих).
  - Опрос Modbus реализован с обработкой ошибок, валидность данных контролируется.
  - Интервал опроса по умолчанию — 5 секунд (SENSOR_READ_INTERVAL).

- **Форматирование показаний:**  
  - Для всех интерфейсов (WEB, MQTT, API, ThingSpeak) используется единое форматирование:
    - Температура, влажность, pH — 1 знак после запятой.
    - EC, N, P, K — целые значения.
  - Форматирование реализовано в `jxct_format_utils.*`, используется везде, кроме MQTT (там числа).

- **MQTT:**  
  - Публикация только числовых значений, без строк и мусора.
  - Payload содержит все параметры и временную метку.
  - Discovery для Home Assistant: уникальный идентификатор, корректные manufacturer/model/sw_version, имя устройства совпадает с deviceId.

- **ThingSpeak:**  
  - Передача всех показаний и временной метки.
  - Интервал публикации настраивается, есть защита от превышения лимита.

- **API:**  
  - Эндпоинт `/api/sensor` (и `/sensor_json`) возвращает актуальные показания и timestamp.
  - Формат JSON соответствует документации.

## 2. Интерфейс

- **WEB:**  
  - Единый стиль: все секции с рамкой, аккуратная верстка, навигация.
  - В режиме AP — только Wi-Fi настройки, в STA — все секции.
  - Кнопки сервисов в отдельном блоке, вертикально, с отступами.
  - Страница показаний обновляется через AJAX (интервал 2 сек).
  - Ссылка на API-эндпоинт отображается отдельным блоком.

## 3. Конфигурирование

- Все переменные централизованы в структуре `Config` (`jxct_config_vars.h`).
- Настройки сохраняются и загружаются через Preferences.
- NTP, MQTT, ThingSpeak настраиваются через web-интерфейс.
- Сброс и перезагрузка доступны через web и кнопку.

## 4. Документация и поддержка

- README актуален, структура проекта прозрачна.
- Код снабжён комментариями, поддерживается Doxygen (настройки в Doxyfile, вывод в docs/html).
- Все основные функции и структуры документированы.

## 5. Безопасность и UX

- В режиме AP сервисные и чувствительные функции недоступны.
- Все формы защищены от пустых/некорректных значений.
- Валидация и обработка ошибок реализованы на всех уровнях.

## 6. Рекомендации

- Для промышленного применения рекомендуется добавить авторизацию на web-интерфейс.
- Для OTA-обновлений реализовать реальную загрузку прошивки.
- Для ThingSpeak — добавить обработку ошибок сети.

---

**Аудит проведён:** [замените на актуальную дату]

--- 