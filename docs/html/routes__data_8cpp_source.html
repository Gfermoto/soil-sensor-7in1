<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JXCT Soil Sensor 7-in-1: Исходный файл src/web/routes_data.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">JXCT Soil Sensor 7-in-1<span id="projectnumber">&#160;v3.4.9 (June 2025)</span>
   </div>
   <div id="projectbrief">Professional IoT soil monitoring system with ESP32, Modbus RTU, MQTT, and advanced compensation algorithms</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Поиск',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('routes__data_8cpp_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Загрузка...</div>
<div class="SRStatus" id="Searching">Поиск...</div>
<div class="SRStatus" id="NoMatches">Не найдено</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">routes_data.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="routes__data_8cpp.html">См. документацию.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &quot;<a class="code" href="web__routes_8h.html">../../include/web_routes.h</a>&quot;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &quot;<a class="code" href="logger_8h.html">../../include/logger.h</a>&quot;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &quot;<a class="code" href="jxct__config__vars_8h.html">../../include/jxct_config_vars.h</a>&quot;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &quot;<a class="code" href="jxct__ui__system_8h.html">../../include/jxct_ui_system.h</a>&quot;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &quot;<a class="code" href="jxct__format__utils_8h.html">../../include/jxct_format_utils.h</a>&quot;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &quot;<a class="code" href="wifi__manager_8h.html">../wifi_manager.h</a>&quot;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="modbus__sensor_8h.html">../modbus_sensor.h</a>&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;calibration_manager.h&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &lt;ArduinoJson.h&gt;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &lt;NTPClient.h&gt;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &lt;LittleFS.h&gt;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;<a class="code" href="jxct__strings_8h.html">../../include/jxct_strings.h</a>&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="keyword">extern</span> NTPClient* <a class="code hl_variable" href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a>;</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">// Объявления внешних функций</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="keyword">extern</span> String <a class="code hl_function" href="routes__data_8cpp.html#ad30c0b8b33e60ccdb13f2e1cc08157c9">navHtml</a>();</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="keyword">extern</span> String <a class="code hl_function" href="routes__data_8cpp.html#adc35370b803782f896c844976a9ad6ce">formatValue</a>(<span class="keywordtype">float</span> value, <span class="keyword">const</span> <span class="keywordtype">char</span>* unit, <span class="keywordtype">int</span> precision);</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="keyword">extern</span> String <a class="code hl_function" href="routes__data_8cpp.html#af857f35623b29612a3b4cc45dd6fff23">getApSsid</a>();</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="comment">// Буфер для загрузки файлов (калибровка через /readings)</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno"><a class="line" href="routes__data_8cpp.html#a75f9cadda2a3d68252ebfeb55df86618">   29</a></span><span class="keyword">static</span> File <a class="code hl_variable" href="routes__calibration_8cpp.html#a75f9cadda2a3d68252ebfeb55df86618">uploadFile</a>;</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno"><a class="line" href="routes__data_8cpp.html#a0b77c83141abb779c6ed77f346019bc2">   30</a></span><span class="keyword">static</span> <a class="code hl_enumeration" href="sensor__compensation_8h.html#aaa92ab56ea828c0bcccad4564b21155d">SoilProfile</a> <a class="code hl_variable" href="routes__calibration_8cpp.html#a0b77c83141abb779c6ed77f346019bc2">uploadProfile</a> = <a class="code hl_enumvalue" href="sensor__compensation_8h.html#aaa92ab56ea828c0bcccad4564b21155dadd8b86e783c5b75c7c9224089b4f239b">SoilProfile::SAND</a>;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno"><a class="line" href="struct_rec_values.html#a93613bd3e62e62e2e5348dbcdbf7141c">   32</a></span><span class="keyword">struct </span><a class="code hl_struct" href="struct_rec_values.html">RecValues</a> { <span class="keywordtype">float</span> <a class="code hl_variable" href="struct_rec_values.html#ad5e68754a138f0b3d4a2fcc8a6d41846">t</a>, <a class="code hl_variable" href="struct_rec_values.html#af5f8d5f555bee5aa71f30afabce004fd">hum</a>, <a class="code hl_variable" href="struct_rec_values.html#a93613bd3e62e62e2e5348dbcdbf7141c">ec</a>, <a class="code hl_variable" href="struct_rec_values.html#ac357ff48495f333eaf3e2b92fd21cf43">ph</a>, <a class="code hl_variable" href="struct_rec_values.html#a33f921599e1cd50cdd79c3a323ec726f">n</a>, <a class="code hl_variable" href="struct_rec_values.html#a16338a277db1e53fc9f557a30777d3c5">p</a>, <a class="code hl_variable" href="struct_rec_values.html#a52e88e1a415453e74e04ab301231bdb6">k</a>; };</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="foldopen" id="foldopen00034" data-start="{" data-end="}">
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno"><a class="line" href="routes__data_8cpp.html#adc74086c185759ebabfbcd18b0abd9bd">   34</a></span><span class="keyword">static</span> <a class="code hl_struct" href="struct_rec_values.html">RecValues</a> <a class="code hl_function" href="routes__data_8cpp.html#adc74086c185759ebabfbcd18b0abd9bd">computeRecommendations</a>()</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>{</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    <span class="comment">// 1. База по культуре или generic</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    <a class="code hl_struct" href="struct_rec_values.html">RecValues</a> rec{21,60,1200,6.3,30,10,25};</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keywordtype">id</span>=<a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.cropId;</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    <span class="keywordflow">if</span>(strlen(<span class="keywordtype">id</span>)&gt;0){</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>        <span class="keywordflow">if</span>      (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;tomato&quot;</span>)==0)      rec={22,60,1500,6.5,40,10,30};</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;cucumber&quot;</span>)==0)    rec={24,70,1800,6.2,35,12,28};</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;pepper&quot;</span>)==0)      rec={23,65,1600,6.3,38,11,29};</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;lettuce&quot;</span>)==0)     rec={20,75,1000,6.0,30,8,25};</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;blueberry&quot;</span>)==0)   rec={18,65,1200,5.0,30,10,20};</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;lawn&quot;</span>)==0)        rec={20,50,800,6.3,25,8,20};</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;grape&quot;</span>)==0)       rec={22,55,1400,6.5,35,12,25};</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;conifer&quot;</span>)==0)     rec={18,55,1000,5.5,25,8,15};</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;strawberry&quot;</span>)==0)  rec={20,70,1500,6.0,35,10,25};</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;apple&quot;</span>)==0)       rec={18,60,1200,6.5,25,10,20};</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;pear&quot;</span>)==0)        rec={18,60,1200,6.5,25,10,20};</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;cherry&quot;</span>)==0)      rec={20,60,1300,6.5,30,10,25};</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;raspberry&quot;</span>)==0)   rec={18,65,1100,6.2,30,10,22};</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;currant&quot;</span>)==0)     rec={17,65,1000,6.2,25,9,20};</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    }</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span> </div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    <span class="comment">// 2. Коррекция по soilProfile (влажность и pH)</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    <span class="keywordtype">int</span> soil=<a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.soilProfile; <span class="comment">// 0 sand,1 loam,2 peat,3 clay</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    <span class="keywordflow">if</span>(soil==0){ rec.hum+=-5; <span class="comment">/* песок */</span> }</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(soil==2){ rec.hum+=10; rec.ph-=0.3f; }</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(soil==3){ rec.hum+=5; <span class="comment">/* глина */</span> }</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(soil==1){ rec.hum+=5; }</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    <span class="comment">// 3. Коррекция по environmentType</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <span class="keywordflow">switch</span>(<a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.environmentType){</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>        <span class="keywordflow">case</span> 1: <span class="comment">// greenhouse</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>            rec.hum+=10; rec.ec+=300; rec.n+=5; rec.k+=5; rec.t+=2; <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>        <span class="keywordflow">case</span> 2: <span class="comment">// indoor</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>            rec.hum+=-5; rec.ec-=200; rec.t+=1; <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    }</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="comment">// 3a. Конверсия NPK в мг/кг (датчик выдаёт мг/кг, таблица хранилась в мг/дм³ ~ экстракт 1:5)</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <span class="keyword">constexpr</span> <span class="keywordtype">float</span> NPK_FACTOR = 6.5f; <span class="comment">// пересчёт мг/дм³ → мг/кг (ρ=1.3 г/см³, влажность ≈30%)</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    rec.n *= NPK_FACTOR;</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    rec.p *= NPK_FACTOR;</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    rec.k *= NPK_FACTOR;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span> </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="comment">// 4. Сезонная коррекция (только если включена)</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.flags.seasonalAdjustEnabled){</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        time_t now=time(<span class="keyword">nullptr</span>); <span class="keyword">struct </span>tm* ti=localtime(&amp;now);</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>        <span class="keywordtype">int</span> m=ti?ti-&gt;tm_mon+1:1;</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        <span class="keywordtype">bool</span> rainy=(m==4||m==5||m==6||m==10);</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>        <span class="comment">// Коррекция влажности и EC</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        <span class="keywordflow">if</span>(rainy){ rec.hum+=5; rec.ec-=100; }</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>        <span class="keywordflow">else</span>{ rec.hum+=-2; rec.ec+=100; }</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>        </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>        <span class="comment">// Коррекция NPK по сезону</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>        <span class="keywordflow">if</span>(<a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.environmentType == 0) { <span class="comment">// Outdoor</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>            <span class="keywordflow">if</span>(m &gt;= 3 &amp;&amp; m &lt;= 5) { <span class="comment">// Весна</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>                rec.n *= 1.20f; <span class="comment">// +20%</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>                rec.p *= 1.15f; <span class="comment">// +15%</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>                rec.k *= 1.10f; <span class="comment">// +10%</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>            }</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(m &gt;= 6 &amp;&amp; m &lt;= 8) { <span class="comment">// Лето</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>                rec.n *= 0.90f; <span class="comment">// -10%</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>                rec.p *= 1.05f; <span class="comment">// +5%</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>                rec.k *= 1.25f; <span class="comment">// +25%</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>            }</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(m &gt;= 9 &amp;&amp; m &lt;= 11) { <span class="comment">// Осень</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>                rec.n *= 0.80f; <span class="comment">// -20%</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>                rec.p *= 1.10f; <span class="comment">// +10%</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>                rec.k *= 1.15f; <span class="comment">// +15%</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>            }</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>            <span class="keywordflow">else</span> { <span class="comment">// Зима</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>                rec.n *= 0.70f; <span class="comment">// -30%</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>                rec.p *= 1.05f; <span class="comment">// +5%</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>                rec.k *= 1.05f; <span class="comment">// +5%</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>            }</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>        }</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.environmentType == 1) { <span class="comment">// Greenhouse</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>            <span class="keywordflow">if</span>(m &gt;= 3 &amp;&amp; m &lt;= 5) { <span class="comment">// Весна</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>                rec.n *= 1.25f; <span class="comment">// +25%</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>                rec.p *= 1.20f; <span class="comment">// +20%</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>                rec.k *= 1.15f; <span class="comment">// +15%</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>            }</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(m &gt;= 6 &amp;&amp; m &lt;= 8) { <span class="comment">// Лето</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>                rec.n *= 1.10f; <span class="comment">// +10%</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>                rec.p *= 1.10f; <span class="comment">// +10%</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>                rec.k *= 1.30f; <span class="comment">// +30%</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>            }</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(m &gt;= 9 &amp;&amp; m &lt;= 11) { <span class="comment">// Осень</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>                rec.n *= 1.15f; <span class="comment">// +15%</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>                rec.p *= 1.15f; <span class="comment">// +15%</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>                rec.k *= 1.20f; <span class="comment">// +20%</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>            }</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>            <span class="keywordflow">else</span> { <span class="comment">// Зима</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>                rec.n *= 1.05f; <span class="comment">// +5%</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>                rec.p *= 1.10f; <span class="comment">// +10%</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>                rec.k *= 1.15f; <span class="comment">// +15%</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>            }</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>        }</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    }</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span> </div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="keywordflow">return</span> rec;</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>}</div>
</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="foldopen" id="foldopen00137" data-start="{" data-end="}">
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno"><a class="line" href="routes__data_8cpp.html#a750e7ca088cd32f9490048becd8d8c70">  137</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="routes__data_8cpp.html#a750e7ca088cd32f9490048becd8d8c70">handleReadingsUpload</a>()</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>{</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    HTTPUpload&amp; upload = <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.upload();</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="keywordflow">if</span> (upload.status == UPLOAD_FILE_START)</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    {</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>        <a class="code hl_function" href="namespace_calibration_manager.html#aee9fe56519e509e44d7f936a7a4c3613">CalibrationManager::init</a>();</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>        <span class="keyword">const</span> <span class="keywordtype">char</span>* path = <a class="code hl_function" href="namespace_calibration_manager.html#a24c0b11ea08e757ae404289fa38e33b3">CalibrationManager::profileToFilename</a>(<a class="code hl_enumvalue" href="sensor__compensation_8h.html#aaa92ab56ea828c0bcccad4564b21155dadd8b86e783c5b75c7c9224089b4f239b">SoilProfile::SAND</a>); <span class="comment">// custom.csv</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        <a class="code hl_variable" href="routes__calibration_8cpp.html#a75f9cadda2a3d68252ebfeb55df86618">uploadFile</a> = LittleFS.open(path, <span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="routes__calibration_8cpp.html#a75f9cadda2a3d68252ebfeb55df86618">uploadFile</a>)</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        {</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>            <a class="code hl_function" href="logger_8cpp.html#a60baa11f08afed73f5a7bc5d31f698ce">logError</a>(<span class="stringliteral">&quot;Не удалось создать файл %s&quot;</span>, path);</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>        }</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    }</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (upload.status == UPLOAD_FILE_WRITE)</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    {</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="routes__calibration_8cpp.html#a75f9cadda2a3d68252ebfeb55df86618">uploadFile</a>)</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>        {</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            <a class="code hl_variable" href="routes__calibration_8cpp.html#a75f9cadda2a3d68252ebfeb55df86618">uploadFile</a>.write(upload.buf, upload.currentSize);</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>        }</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    }</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (upload.status == UPLOAD_FILE_END)</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    {</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="routes__calibration_8cpp.html#a75f9cadda2a3d68252ebfeb55df86618">uploadFile</a>)</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        {</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            <a class="code hl_variable" href="routes__calibration_8cpp.html#a75f9cadda2a3d68252ebfeb55df86618">uploadFile</a>.close();</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>            <a class="code hl_function" href="logger_8cpp.html#a54dab32db32234798ff063ccc0dde695">logSuccess</a>(<span class="stringliteral">&quot;Файл калибровки загружен (%u байт)&quot;</span>, upload.totalSize);</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        }</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.sendHeader(<span class="stringliteral">&quot;Location&quot;</span>, <span class="stringliteral">&quot;/readings?toast=Калибровка+загружена&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.send(302, <span class="stringliteral">&quot;text/plain&quot;</span>, <span class="stringliteral">&quot;Redirect&quot;</span>);</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    }</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>}</div>
</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="foldopen" id="foldopen00169" data-start="{" data-end="}">
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno"><a class="line" href="routes__data_8cpp.html#abbd29afd9c684d507a0787906872c9d9">  169</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="routes__data_8cpp.html#abbd29afd9c684d507a0787906872c9d9">handleProfileSave</a>()</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>{</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.hasArg(<span class="stringliteral">&quot;soil_profile&quot;</span>))</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    {</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        String profileStr = <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.arg(<span class="stringliteral">&quot;soil_profile&quot;</span>);</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        <span class="keywordflow">if</span> (profileStr == <span class="stringliteral">&quot;sand&quot;</span>) <a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.soilProfile = 0;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (profileStr == <span class="stringliteral">&quot;loam&quot;</span>) <a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.soilProfile = 1;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (profileStr == <span class="stringliteral">&quot;peat&quot;</span>) <a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.soilProfile = 2;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (profileStr == <span class="stringliteral">&quot;clay&quot;</span>) <a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.soilProfile = 3;</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        <a class="code hl_function" href="config_8cpp.html#a688d00bbabd28fbaf9e0c50eca3adeae">saveConfig</a>();</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>        <a class="code hl_function" href="logger_8cpp.html#a54dab32db32234798ff063ccc0dde695">logSuccess</a>(<span class="stringliteral">&quot;Профиль почвы изменён на %s&quot;</span>, profileStr.c_str());</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    }</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.sendHeader(<span class="stringliteral">&quot;Location&quot;</span>, <span class="stringliteral">&quot;/readings?toast=Профиль+сохранен&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.send(302, <span class="stringliteral">&quot;text/plain&quot;</span>, <span class="stringliteral">&quot;Redirect&quot;</span>);</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>}</div>
</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="foldopen" id="foldopen00186" data-start="{" data-end="}">
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno"><a class="line" href="routes__data_8cpp.html#a7cb04ca38fc8e4b768a2ef6ae67bc573">  186</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="routes__data_8cpp.html#a7cb04ca38fc8e4b768a2ef6ae67bc573">sendSensorJson</a>()</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>{</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    <span class="comment">// unified JSON response for sensor data</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    <a class="code hl_function" href="error__handlers_8cpp.html#a1a62e7c40bff885d97f6018743bec642">logWebRequest</a>(<span class="stringliteral">&quot;GET&quot;</span>, <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.uri(), <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.client().remoteIP().toString());</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="routes__config_8cpp.html#afd1ea40c3b78acfa354aed81da58e582">currentWiFiMode</a> != <a class="code hl_enumvalue" href="wifi__manager_8h.html#ae685142b922ea26aa869f6cb5e17a19ca971ab16c6e59a04d070cb8d8da13418e">WiFiMode::STA</a>)</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    {</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>        <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.send(403, <span class="stringliteral">&quot;application/json&quot;</span>, <span class="stringliteral">&quot;{\&quot;error\&quot;:\&quot;AP mode\&quot;}&quot;</span>);</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    }</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span> </div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    StaticJsonDocument&lt;512&gt; doc;</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    doc[<span class="stringliteral">&quot;temperature&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a9a843da2888c9b8014dd9506284f1351">format_temperature</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.temperature);</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    doc[<span class="stringliteral">&quot;humidity&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a3be478cef555484efe62159216f6d470">format_moisture</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.humidity);</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    doc[<span class="stringliteral">&quot;ec&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a39b2dedc3670adcf20a62a8d113d2483">format_ec</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.ec);</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    doc[<span class="stringliteral">&quot;ph&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a416ab24406c338058778bbde7c4da152">format_ph</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.ph);</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    doc[<span class="stringliteral">&quot;nitrogen&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#abdc9f6cdc05f0aa72eec54b3e904ca7b">format_npk</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.nitrogen);</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    doc[<span class="stringliteral">&quot;phosphorus&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#abdc9f6cdc05f0aa72eec54b3e904ca7b">format_npk</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.phosphorus);</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    doc[<span class="stringliteral">&quot;potassium&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#abdc9f6cdc05f0aa72eec54b3e904ca7b">format_npk</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.potassium);</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    doc[<span class="stringliteral">&quot;raw_temperature&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a9a843da2888c9b8014dd9506284f1351">format_temperature</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.raw_temperature);</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    doc[<span class="stringliteral">&quot;raw_humidity&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a3be478cef555484efe62159216f6d470">format_moisture</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.raw_humidity);</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    doc[<span class="stringliteral">&quot;raw_ec&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a39b2dedc3670adcf20a62a8d113d2483">format_ec</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.raw_ec);</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    doc[<span class="stringliteral">&quot;raw_ph&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a416ab24406c338058778bbde7c4da152">format_ph</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.raw_ph);</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    doc[<span class="stringliteral">&quot;raw_nitrogen&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#abdc9f6cdc05f0aa72eec54b3e904ca7b">format_npk</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.raw_nitrogen);</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    doc[<span class="stringliteral">&quot;raw_phosphorus&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#abdc9f6cdc05f0aa72eec54b3e904ca7b">format_npk</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.raw_phosphorus);</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    doc[<span class="stringliteral">&quot;raw_potassium&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#abdc9f6cdc05f0aa72eec54b3e904ca7b">format_npk</a>(<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.raw_potassium);</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    doc[<span class="stringliteral">&quot;irrigation&quot;</span>] = <a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.recentIrrigation;</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span> </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <a class="code hl_struct" href="struct_rec_values.html">RecValues</a> rec = <a class="code hl_function" href="routes__data_8cpp.html#adc74086c185759ebabfbcd18b0abd9bd">computeRecommendations</a>();</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    doc[<span class="stringliteral">&quot;rec_temperature&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a9a843da2888c9b8014dd9506284f1351">format_temperature</a>(rec.<a class="code hl_variable" href="struct_rec_values.html#ad5e68754a138f0b3d4a2fcc8a6d41846">t</a>);</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    doc[<span class="stringliteral">&quot;rec_humidity&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a3be478cef555484efe62159216f6d470">format_moisture</a>(rec.<a class="code hl_variable" href="struct_rec_values.html#af5f8d5f555bee5aa71f30afabce004fd">hum</a>);</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    doc[<span class="stringliteral">&quot;rec_ec&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a39b2dedc3670adcf20a62a8d113d2483">format_ec</a>(rec.<a class="code hl_variable" href="struct_rec_values.html#a93613bd3e62e62e2e5348dbcdbf7141c">ec</a>);</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    doc[<span class="stringliteral">&quot;rec_ph&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#a416ab24406c338058778bbde7c4da152">format_ph</a>(rec.<a class="code hl_variable" href="struct_rec_values.html#ac357ff48495f333eaf3e2b92fd21cf43">ph</a>);</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    doc[<span class="stringliteral">&quot;rec_nitrogen&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#abdc9f6cdc05f0aa72eec54b3e904ca7b">format_npk</a>(rec.<a class="code hl_variable" href="struct_rec_values.html#a33f921599e1cd50cdd79c3a323ec726f">n</a>);</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    doc[<span class="stringliteral">&quot;rec_phosphorus&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#abdc9f6cdc05f0aa72eec54b3e904ca7b">format_npk</a>(rec.<a class="code hl_variable" href="struct_rec_values.html#a16338a277db1e53fc9f557a30777d3c5">p</a>);</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    doc[<span class="stringliteral">&quot;rec_potassium&quot;</span>] = <a class="code hl_function" href="jxct__format__utils_8cpp.html#abdc9f6cdc05f0aa72eec54b3e904ca7b">format_npk</a>(rec.<a class="code hl_variable" href="struct_rec_values.html#a52e88e1a415453e74e04ab301231bdb6">k</a>);</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span> </div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="comment">// ---- Дополнительная информация ----</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    <span class="comment">// Сезон по текущему месяцу</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* seasonName = [](){</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>        <span class="comment">// Проверяем инициализацию NTP</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a> == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>            <span class="keyword">extern</span> WiFiUDP <a class="code hl_variable" href="main_8cpp.html#a22f33e7e05df58bb6145bb6e543e232a">ntpUDP</a>;</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>            <a class="code hl_variable" href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a> = <span class="keyword">new</span> NTPClient(<a class="code hl_variable" href="main_8cpp.html#a22f33e7e05df58bb6145bb6e543e232a">ntpUDP</a>, <span class="stringliteral">&quot;pool.ntp.org&quot;</span>, 0, 3600000);</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>            <a class="code hl_variable" href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a>-&gt;begin();</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>        }</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>        </div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        time_t now = <a class="code hl_variable" href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a> ? (time_t)<a class="code hl_variable" href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a>-&gt;getEpochTime() : time(<span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>        <span class="comment">// если время &lt; 2000-01-01 считаем, что NTP ещё не синхронизирован</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>        <span class="keywordflow">if</span> (now &lt; 946684800) {</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>            <span class="comment">// Пробуем обновить NTP</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a>) {</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>                <a class="code hl_variable" href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a>-&gt;forceUpdate();</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>                now = (time_t)<a class="code hl_variable" href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a>-&gt;getEpochTime();</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>                <span class="keywordflow">if</span> (now &lt; 946684800) <span class="keywordflow">return</span> <span class="stringliteral">&quot;Н/Д&quot;</span>;</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Н/Д&quot;</span>;</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>            }</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>        }</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        <span class="keyword">struct </span>tm* ti = localtime(&amp;now);</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>        <span class="keywordflow">if</span> (!ti) <span class="keywordflow">return</span> <span class="stringliteral">&quot;Н/Д&quot;</span>;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>        uint8_t m = ti-&gt;tm_mon + 1;</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        <span class="keywordflow">if</span> (m==12 || m==1 || m==2) <span class="keywordflow">return</span> <span class="stringliteral">&quot;Зима&quot;</span>;</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        <span class="keywordflow">if</span> (m&gt;=3 &amp;&amp; m&lt;=5)           <span class="keywordflow">return</span> <span class="stringliteral">&quot;Весна&quot;</span>;</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>        <span class="keywordflow">if</span> (m&gt;=6 &amp;&amp; m&lt;=8)           <span class="keywordflow">return</span> <span class="stringliteral">&quot;Лето&quot;</span>;</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Осень&quot;</span>;</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    }();</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    doc[<span class="stringliteral">&quot;season&quot;</span>] = seasonName;</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="comment">// Проверяем отклонения</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    String alerts=<span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    <span class="keyword">auto</span> append=[&amp;](<span class="keyword">const</span> <span class="keywordtype">char</span>* n){ <span class="keywordflow">if</span>(alerts.length()) alerts += <span class="stringliteral">&quot;, &quot;</span>; alerts += n; };</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <span class="comment">// Физические пределы датчика</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.temperature &lt; -45 || <a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.temperature &gt; 115) append(<span class="stringliteral">&quot;T&quot;</span>);</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.humidity    &lt;   0 || <a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.humidity    &gt; 100) append(<span class="stringliteral">&quot;θ&quot;</span>);</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.ec          &lt;   0 || <a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.ec          &gt; 10000) append(<span class="stringliteral">&quot;EC&quot;</span>);</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.ph          &lt;   3 || <a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.ph          &gt; 9) append(<span class="stringliteral">&quot;pH&quot;</span>);</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.nitrogen    &lt;   0 || <a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.nitrogen    &gt; 1999) append(<span class="stringliteral">&quot;N&quot;</span>);</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.phosphorus  &lt;   0 || <a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.phosphorus  &gt; 1999) append(<span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.potassium   &lt;   0 || <a class="code hl_variable" href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a>.potassium   &gt; 1999) append(<span class="stringliteral">&quot;K&quot;</span>);</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    doc[<span class="stringliteral">&quot;alerts&quot;</span>] = alerts;</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    doc[<span class="stringliteral">&quot;timestamp&quot;</span>] = (long)(<a class="code hl_variable" href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a> ? <a class="code hl_variable" href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a>-&gt;getEpochTime() : 0);</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span> </div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    String json;</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    serializeJson(doc, json);</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.send(200, <span class="stringliteral">&quot;application/json&quot;</span>, json);</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>}</div>
</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="foldopen" id="foldopen00274" data-start="{" data-end="}">
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno"><a class="line" href="routes__data_8cpp.html#aed1136f683a386e56678e05fc3747972">  274</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="routes__data_8cpp.html#aed1136f683a386e56678e05fc3747972">setupDataRoutes</a>()</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>{</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    <span class="comment">// Красивая страница показаний с иконками (оригинальный дизайн)</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.on(<span class="stringliteral">&quot;/readings&quot;</span>, HTTP_GET,</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>                 []()</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>                 {</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>                     <a class="code hl_function" href="error__handlers_8cpp.html#a1a62e7c40bff885d97f6018743bec642">logWebRequest</a>(<span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;/readings&quot;</span>, <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.client().remoteIP().toString());</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>                     <span class="keywordflow">if</span> (<a class="code hl_variable" href="routes__config_8cpp.html#afd1ea40c3b78acfa354aed81da58e582">currentWiFiMode</a> == <a class="code hl_enumvalue" href="wifi__manager_8h.html#ae685142b922ea26aa869f6cb5e17a19ca0fd3f8dd5edc33b28db1162e15e8fcbc">WiFiMode::AP</a>)</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>                     {</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>                         <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.send(200, <span class="stringliteral">&quot;text/html; charset=utf-8&quot;</span>, <a class="code hl_function" href="web__templates_8cpp.html#a1d57b5edf50f600cc5d02641cb4510a0">generateApModeUnavailablePage</a>(<span class="stringliteral">&quot;Показания&quot;</span>, <a class="code hl_define" href="jxct__ui__system_8h.html#a075f0130a6ec13e19f3da60e46f893ef">UI_ICON_DATA</a>));</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>                         <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>                     }</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span> </div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>                     String html = <a class="code hl_function" href="web__templates_8cpp.html#ac4502db1ad8d9e08830f7eb784d62600">generatePageHeader</a>(<span class="stringliteral">&quot;Показания датчика&quot;</span>, <a class="code hl_define" href="jxct__ui__system_8h.html#a075f0130a6ec13e19f3da60e46f893ef">UI_ICON_DATA</a>);</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>                     html += <a class="code hl_function" href="routes__data_8cpp.html#ad30c0b8b33e60ccdb13f2e1cc08157c9">navHtml</a>();</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>                     html += <span class="stringliteral">&quot;&lt;h1&gt;&quot;</span> <a class="code hl_define" href="jxct__ui__system_8h.html#a075f0130a6ec13e19f3da60e46f893ef">UI_ICON_DATA</a> <span class="stringliteral">&quot; Показания датчика&lt;/h1&gt;&quot;</span>;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>                     </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>                     <span class="comment">// Информационная строка состояния</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>                     html += <span class="stringliteral">&quot;&lt;div id=&#39;statusInfo&#39; style=&#39;margin:10px 0;font-size:16px;color:#333&#39;&gt;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>                     </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>                     <span class="comment">// ======= ОБЪЯСНЕНИЕ ПРОЦЕССОВ =======</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>                     html += <span class="stringliteral">&quot;&lt;div class=&#39;section&#39; style=&#39;background:#f8f9fa;padding:15px;border-radius:8px;margin:15px 0;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>                     html += <span class="stringliteral">&quot;&lt;h3&gt;📋 Как работают показания&lt;/h3&gt;&quot;</span>;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>                     html += <span class="stringliteral">&quot;&lt;div style=&#39;display:grid;grid-template-columns:1fr 1fr;gap:20px;font-size:14px;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>                     </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>                     <span class="comment">// Левая колонка - компенсация</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>                     html += <span class="stringliteral">&quot;&lt;div&gt;&quot;</span>;</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>                     html += <span class="stringliteral">&quot;&lt;h4&gt;🔧 Компенсация показаний&lt;/h4&gt;&quot;</span>;</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>                     html += <span class="stringliteral">&quot;&lt;ul style=&#39;margin:0;padding-left:20px;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;&lt;strong&gt;RAW&lt;/strong&gt; - сырые данные с датчика&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;&lt;strong&gt;Компенс.&lt;/strong&gt; - данные после математической компенсации:&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>                     html += <span class="stringliteral">&quot;&lt;ul style=&#39;margin:5px 0;padding-left:15px;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;🌡️ &lt;strong&gt;Температура:&lt;/strong&gt; без изменений&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;💧 &lt;strong&gt;Влажность:&lt;/strong&gt; без изменений&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;⚡ &lt;strong&gt;EC:&lt;/strong&gt; температурная компенсация + модель Арчи (Archie, 1942)&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;⚗️ &lt;strong&gt;pH:&lt;/strong&gt; температурная поправка по Нернсту (-0.003×ΔT)&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;🔴🟡🔵 &lt;strong&gt;NPK:&lt;/strong&gt; коррекция по T, влажности и типу почвы (FAO 56 + Eur. J. Soil Sci.)&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>                     html += <span class="stringliteral">&quot;&lt;/ul&gt;&quot;</span>;</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>                     html += <span class="stringliteral">&quot;&lt;/ul&gt;&quot;</span>;</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>                     html += <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                     </div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>                     <span class="comment">// Правая колонка - рекомендации</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>                     html += <span class="stringliteral">&quot;&lt;div&gt;&quot;</span>;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>                     html += <span class="stringliteral">&quot;&lt;h4&gt;🎯 Рекомендации&lt;/h4&gt;&quot;</span>;</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>                     html += <span class="stringliteral">&quot;&lt;ul style=&#39;margin:0;padding-left:20px;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;&lt;strong&gt;Базовые нормы&lt;/strong&gt; для выбранной культуры&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;&lt;strong&gt;Сезонные корректировки&lt;/strong&gt; (весна/лето/осень/зима)&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;&lt;strong&gt;Тип среды&lt;/strong&gt; (открытый грунт/теплица/помещение)&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;&lt;strong&gt;Цветовая индикация:&lt;/strong&gt;&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>                     html += <span class="stringliteral">&quot;&lt;ul style=&#39;margin:5px 0;padding-left:15px;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;🟢 &lt;strong&gt;Зеленый:&lt;/strong&gt; в норме&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;🟡 &lt;strong&gt;Желтый:&lt;/strong&gt; близко к границам&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;🟠 &lt;strong&gt;Оранжевый:&lt;/strong&gt; отклонение &gt;20%&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;🔴 &lt;strong&gt;Красный:&lt;/strong&gt; критическое отклонение&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>                     html += <span class="stringliteral">&quot;&lt;/ul&gt;&quot;</span>;</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>                     html += <span class="stringliteral">&quot;&lt;/ul&gt;&quot;</span>;</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>                     html += <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>                     </div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>                     html += <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>                     html += <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>                     </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>                     <span class="comment">// Заголовок 4-го столбца: выбранная культура или «Реком.»</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>                     String recHeader = <span class="stringliteral">&quot;Реком.&quot;</span>;</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>                     <span class="keywordflow">if</span> (strlen(<a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.cropId) &gt; 0)</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>                     {</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>                         <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keywordtype">id</span> = <a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.cropId;</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>                         <span class="keywordflow">if</span>      (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;tomato&quot;</span>)==0)      recHeader = <span class="stringliteral">&quot;Томаты&quot;</span>;</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;cucumber&quot;</span>)==0)    recHeader = <span class="stringliteral">&quot;Огурцы&quot;</span>;</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;pepper&quot;</span>)==0)      recHeader = <span class="stringliteral">&quot;Перец&quot;</span>;</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;lettuce&quot;</span>)==0)     recHeader = <span class="stringliteral">&quot;Салат&quot;</span>;</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;blueberry&quot;</span>)==0)   recHeader = <span class="stringliteral">&quot;Голубика&quot;</span>;</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;lawn&quot;</span>)==0)        recHeader = <span class="stringliteral">&quot;Газон&quot;</span>;</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;grape&quot;</span>)==0)       recHeader = <span class="stringliteral">&quot;Виноград&quot;</span>;</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;conifer&quot;</span>)==0)     recHeader = <span class="stringliteral">&quot;Хвойные&quot;</span>;</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;strawberry&quot;</span>)==0)  recHeader = <span class="stringliteral">&quot;Клубника&quot;</span>;</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;apple&quot;</span>)==0)       recHeader = <span class="stringliteral">&quot;Яблоня&quot;</span>;</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;pear&quot;</span>)==0)        recHeader = <span class="stringliteral">&quot;Груша&quot;</span>;</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;cherry&quot;</span>)==0)      recHeader = <span class="stringliteral">&quot;Вишня&quot;</span>;</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;raspberry&quot;</span>)==0)   recHeader = <span class="stringliteral">&quot;Малина&quot;</span>;</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">id</span>,<span class="stringliteral">&quot;currant&quot;</span>)==0)     recHeader = <span class="stringliteral">&quot;Смородина&quot;</span>;</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>                     }</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span> </div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>                     html += <span class="stringliteral">&quot;&lt;div class=&#39;section&#39;&gt;&lt;table class=&#39;data&#39;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;RAW&lt;/th&gt;&lt;th&gt;Компенс.&lt;/th&gt;&lt;th&gt;&quot;</span> + recHeader + <span class="stringliteral">&quot;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;</span>;</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>                     html += <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;🌡️ Температура, °C&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;temp_raw&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;temp&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;temp_rec&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>                     html += <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;💧 Влажность, %&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;hum_raw&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;hum&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;hum_rec&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>                     html += <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;⚡ EC, µS/cm&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;ec_raw&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;ec&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;ec_rec&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>                     html += <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;⚗️ pH&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;ph_raw&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;ph&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;ph_rec&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>                     html += <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;🔴 Азот (N), мг/кг&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;n_raw&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;n&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;n_rec&#39;&gt;&lt;/span&gt;&lt;span id=&#39;n_season&#39; class=&#39;season-adj&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>                     html += <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;🟡 Фосфор (P), мг/кг&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;p_raw&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;p&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;p_rec&#39;&gt;&lt;/span&gt;&lt;span id=&#39;p_season&#39; class=&#39;season-adj&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>                     html += <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;🔵 Калий (K), мг/кг&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;k_raw&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;k&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;span id=&#39;k_rec&#39;&gt;&lt;/span&gt;&lt;span id=&#39;k_season&#39; class=&#39;season-adj&#39;&gt;&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>                     html += <span class="stringliteral">&quot;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>                     </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>                     <span class="comment">// ======= КАЛИБРОВКА =======</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>                     <span class="keywordtype">bool</span> csvPresent = <a class="code hl_function" href="namespace_calibration_manager.html#a1ee0f1f244cb68eaa7e47a79deb452b6">CalibrationManager::hasTable</a>(<a class="code hl_enumvalue" href="sensor__compensation_8h.html#aaa92ab56ea828c0bcccad4564b21155dadd8b86e783c5b75c7c9224089b4f239b">SoilProfile::SAND</a>); <span class="comment">// custom.csv</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>                     html += <span class="stringliteral">&quot;&lt;div class=&#39;section&#39;&gt;&lt;h2&gt;⚙️ Калибровка датчика&lt;/h2&gt;&quot;</span>;</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>                     </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>                     <span class="comment">// Статус калибровки</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>                     html += <span class="stringliteral">&quot;&lt;div style=&#39;background:#f8f9fa;padding:15px;border-radius:8px;margin:15px 0;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>                     html += <span class="stringliteral">&quot;&lt;h4&gt;📊 Текущий статус калибровки&lt;/h4&gt;&quot;</span>;</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>                     <span class="keywordflow">if</span> (!<a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.flags.calibrationEnabled) {</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>                         html += <span class="stringliteral">&quot;&lt;p style=&#39;color:#9E9E9E;margin:5px 0;&#39;&gt;❌ &lt;strong&gt;Компенсация выключена&lt;/strong&gt; - используются только математические поправки&lt;/p&gt;&quot;</span>;</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (csvPresent) {</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>                         html += <span class="stringliteral">&quot;&lt;p style=&#39;color:#4CAF50;margin:5px 0;&#39;&gt;✅ &lt;strong&gt;CSV таблица загружена&lt;/strong&gt; - применяется лабораторная калибровка + математическая компенсация&lt;/p&gt;&quot;</span>;</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>                     } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>                         html += <span class="stringliteral">&quot;&lt;p style=&#39;color:#2196F3;margin:5px 0;&#39;&gt;⚠️ &lt;strong&gt;CSV таблица не загружена&lt;/strong&gt; - применяется только математическая компенсация&lt;/p&gt;&quot;</span>;</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>                     }</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>                     html += <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>                     </div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>                     <span class="comment">// Объяснение калибровочной таблицы</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>                     html += <span class="stringliteral">&quot;&lt;div style=&#39;background:#f8f9fa;border-left:4px solid #007bff;padding:10px;margin:10px 0;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>                     html += <span class="stringliteral">&quot;&lt;h4 style=&#39;margin:0 0 8px 0;color:#007bff;&#39;&gt;📊 &lt;strong&gt;Калибровочная таблица (CSV)&lt;/strong&gt;&lt;/h4&gt;&quot;</span>;</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>                     html += <span class="stringliteral">&quot;&lt;p style=&#39;margin:5px 0;font-size:14px;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>                     html += <span class="stringliteral">&quot;Это файл с коэффициентами коррекции, полученными при поверке датчика в лаборатории. &quot;</span>;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>                     html += <span class="stringliteral">&quot;Содержит коррекции для всех параметров: &lt;strong&gt;температура, влажность, EC, pH, азот, фосфор, калий&lt;/strong&gt;. &quot;</span>;</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>                     html += <span class="stringliteral">&quot;Формат: &lt;code&gt;сырое_значение,коэффициент_коррекции&lt;/code&gt;&quot;</span>;</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>                     html += <span class="stringliteral">&quot;&lt;/p&gt;&quot;</span>;</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>                     html += <span class="stringliteral">&quot;&lt;p style=&#39;margin:5px 0;font-size:14px;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>                     html += <span class="stringliteral">&quot;💡 &lt;strong&gt;Применение:&lt;/strong&gt; &lt;code&gt;скорректированное = сырое × коэффициент&lt;/code&gt;&quot;</span>;</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>                     html += <span class="stringliteral">&quot;&lt;/p&gt;&quot;</span>;</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>                     html += <span class="stringliteral">&quot;&lt;p style=&#39;margin:5px 0;font-size:14px;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>                     html += <span class="stringliteral">&quot;📄 &lt;a href=&#39;/docs/examples/calibration_example.csv&#39; target=&#39;_blank&#39; style=&#39;color:#2196F3;&#39;&gt;Скачать пример CSV файла&lt;/a&gt;&quot;</span>;</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>                     html += <span class="stringliteral">&quot;&lt;/p&gt;&quot;</span>;</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>                     html += <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>                     </div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>                     <span class="comment">// Форма загрузки CSV</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>                     html += <span class="stringliteral">&quot;&lt;form action=&#39;/readings/upload&#39; method=&#39;post&#39; enctype=&#39;multipart/form-data&#39; style=&#39;margin-top:15px;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>                     html += <span class="stringliteral">&quot;&lt;div class=&#39;form-group&#39;&gt;&lt;label for=&#39;calibration_csv&#39;&gt;&lt;strong&gt;Загрузить CSV файл калибровки:&lt;/strong&gt;&lt;/label&gt;&quot;</span>;</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>                     html += <span class="stringliteral">&quot;&lt;input type=&#39;file&#39; id=&#39;calibration_csv&#39; name=&#39;calibration_csv&#39; accept=&#39;.csv&#39; required style=&#39;margin:5px 0;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>                     html += <span class="stringliteral">&quot;&lt;div style=&#39;font-size:12px;color:#666;margin:5px 0;&#39;&gt;Файл должен содержать пары значений: сырое_значение,коэффициент_коррекции&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>                     html += <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>                     html += <a class="code hl_function" href="jxct__ui__system_8cpp.html#a7834ec4c73014039a2aeeedadff41141">generateButton</a>(<a class="code hl_enumvalue" href="jxct__ui__system_8h.html#ae2d5c50fae96a83cc4f5974af78e6943a428429ba9ea83e4841036fb0508fd6dc">ButtonType::PRIMARY</a>, <a class="code hl_define" href="jxct__ui__system_8h.html#a0de268b94c85f6f3363294f873e67096">UI_ICON_UPLOAD</a>, <span class="stringliteral">&quot;Загрузить CSV&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>                     html += <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>                     </div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>                     <span class="comment">// Кнопка сброса CSV, если файл существует</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>                     <span class="keywordflow">if</span>(csvPresent){</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>                         html += <span class="stringliteral">&quot;&lt;form action=&#39;/readings/csv_reset&#39; method=&#39;post&#39; style=&#39;margin-top:10px;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>                         html += <a class="code hl_function" href="jxct__ui__system_8cpp.html#a7834ec4c73014039a2aeeedadff41141">generateButton</a>(<a class="code hl_enumvalue" href="jxct__ui__system_8h.html#ae2d5c50fae96a83cc4f5974af78e6943a371b09d93ca01e09a42fbd5a2a423f8e">ButtonType::SECONDARY</a>, <span class="stringliteral">&quot;🗑️&quot;</span>, <span class="stringliteral">&quot;Удалить CSV таблицу&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>                         html += <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>                     }</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>                     html += <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>                     </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>                     <span class="comment">// ======= ДОПОЛНИТЕЛЬНАЯ ИНФОРМАЦИЯ =======</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>                     html += <span class="stringliteral">&quot;&lt;div class=&#39;section&#39; style=&#39;background:#e8f5e8;padding:15px;border-radius:8px;margin:15px 0;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>                     html += <span class="stringliteral">&quot;&lt;h4&gt;💡 Полезная информация&lt;/h4&gt;&quot;</span>;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>                     html += <span class="stringliteral">&quot;&lt;ul style=&#39;margin:5px 0;padding-left:20px;font-size:14px;&#39;&gt;&quot;</span>;</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;&lt;strong&gt;Стрелки ↑↓&lt;/strong&gt; показывают направление изменений после компенсации&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;&lt;strong&gt;Сезонные корректировки&lt;/strong&gt; учитывают потребности растений в разные периоды&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;&lt;strong&gt;Валидность данных&lt;/strong&gt; проверяется по диапазонам и логическим связям&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>                     html += <span class="stringliteral">&quot;&lt;li&gt;&lt;strong&gt;Интервал обновления:&lt;/strong&gt; каждые 3 секунды&lt;/li&gt;&quot;</span>;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>                     html += <span class="stringliteral">&quot;&lt;/ul&gt;&quot;</span>;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>                     html += <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span> </div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>                     html += <span class="stringliteral">&quot;&lt;style&gt;&quot;</span>;</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>                     html += <span class="stringliteral">&quot;.season-adj { font-size: 0.8em; margin-left: 5px; }&quot;</span>;</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>                     html += <span class="stringliteral">&quot;.season-adj.up { color: #2ecc71; }&quot;</span>;</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>                     html += <span class="stringliteral">&quot;.season-adj.down { color: #e74c3c; }&quot;</span>;</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>                     html += <span class="stringliteral">&quot;.data{width:100%;border-collapse:collapse}.data th,.data td{border:1px solid #ccc;padding:6px;text-align:center}.data th{background:#f5f5f5}.green{color:#4CAF50}.yellow{color:#FFC107}.orange{color:#FF9800}.red{color:#F44336}&quot;</span>;</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>                     html += <span class="stringliteral">&quot;&lt;/style&gt;&quot;</span>;</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>                     </div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>                     html += <span class="stringliteral">&quot;&lt;script&gt;&quot;</span>;</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>                     html += <span class="stringliteral">&quot;function set(id,v){if(v!==undefined&amp;&amp;v!==null){document.getElementById(id).textContent=v;}}&quot;</span>;</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>                     html += <span class="stringliteral">&quot;function colorDelta(a,b){var diff=Math.abs(a-b)/b*100;if(diff&gt;30)return &#39;red&#39;;if(diff&gt;20)return &#39;orange&#39;;if(diff&gt;10)return &#39;yellow&#39;;return &#39;&#39;;}&quot;</span>;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>                     html += <span class="stringliteral">&quot;function colorRange(v,min,max){var span=(max-min);if(span&lt;=0)return &#39;&#39;;if(v&lt;min||v&gt;max)return &#39;red&#39;;if(v&lt;min+0.05*span||v&gt;max-0.05*span)return &#39;orange&#39;;if(v&lt;min+0.10*span||v&gt;max-0.10*span)return &#39;yellow&#39;;return &#39;&#39;;}&quot;</span>;</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>                     html += <span class="stringliteral">&quot;function applyColor(spanId,cls){var el=document.getElementById(spanId);if(!el)return;el.classList.remove(&#39;red&#39;,&#39;orange&#39;,&#39;yellow&#39;,&#39;green&#39;);if(cls){el.classList.add(cls);}else{el.classList.add(&#39;green&#39;);}}&quot;</span>;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>                     html += <span class="stringliteral">&quot;var limits={temp:{min:-45,max:115},hum:{min:0,max:100},ec:{min:0,max:10000},ph:{min:3,max:9},n:{min:0,max:1999},p:{min:0,max:1999},k:{min:0,max:1999}};&quot;</span>;</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>                     html += <span class="stringliteral">&quot;function updateSensor(){&quot;</span>;</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>                     html += <span class="stringliteral">&quot;fetch(&#39;/sensor_json&#39;).then(r=&gt;r.json()).then(d=&gt;{&quot;</span>;</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>                     html += <span class="stringliteral">&quot;set(&#39;temp_raw&#39;,d.raw_temperature);&quot;</span>;</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>                     html += <span class="stringliteral">&quot;set(&#39;hum_raw&#39;,d.raw_humidity);&quot;</span>;</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>                     html += <span class="stringliteral">&quot;set(&#39;ec_raw&#39;,d.raw_ec);&quot;</span>;</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>                     html += <span class="stringliteral">&quot;set(&#39;ph_raw&#39;,d.raw_ph);&quot;</span>;</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>                     html += <span class="stringliteral">&quot;set(&#39;n_raw&#39;,d.raw_nitrogen);&quot;</span>;</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>                     html += <span class="stringliteral">&quot;set(&#39;p_raw&#39;,d.raw_phosphorus);&quot;</span>;</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>                     html += <span class="stringliteral">&quot;set(&#39;k_raw&#39;,d.raw_potassium);&quot;</span>;</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>                     html += <span class="stringliteral">&quot;set(&#39;temp_rec&#39;,d.rec_temperature);set(&#39;hum_rec&#39;,d.rec_humidity);set(&#39;ec_rec&#39;,d.rec_ec);set(&#39;ph_rec&#39;,d.rec_ph);set(&#39;n_rec&#39;,d.rec_nitrogen);set(&#39;p_rec&#39;,d.rec_phosphorus);set(&#39;k_rec&#39;,d.rec_potassium);&quot;</span>;</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>                     <span class="comment">// === Arrow indicators block ===</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>                     html += <span class="stringliteral">&quot;const tol={temp:0.2,hum:0.5,ec:20,ph:0.05,n:5,p:3,k:3};&quot;</span>;</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>                     html += <span class="stringliteral">&quot;function arrowSign(base,val,thr){base=parseFloat(base);val=parseFloat(val);if(isNaN(base)||isNaN(val))return &#39;&#39;;if(val&gt;base+thr)return &#39;↑ &#39;;if(val&lt;base-thr)return &#39;↓ &#39;;return &#39;&#39;;};&quot;</span>;</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>                     html += <span class="stringliteral">&quot;function showWithArrow(id,sign,value){document.getElementById(id).textContent=sign+value;}&quot;</span>;</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span> </div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>                     <span class="comment">// Compensated vs RAW arrows</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;temp&#39;, arrowSign(d.raw_temperature ,d.temperature ,tol.temp), d.temperature);&quot;</span>;</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;hum&#39;,  arrowSign(d.raw_humidity    ,d.humidity    ,tol.hum ), d.humidity);&quot;</span>;</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;ec&#39;,   arrowSign(d.raw_ec          ,d.ec          ,tol.ec  ), d.ec);&quot;</span>;</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;ph&#39;,   arrowSign(d.raw_ph          ,d.ph          ,tol.ph  ), d.ph);&quot;</span>;</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;n&#39;,    arrowSign(d.raw_nitrogen    ,d.nitrogen    ,tol.n   ), d.nitrogen);&quot;</span>;</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;p&#39;,    arrowSign(d.raw_phosphorus  ,d.phosphorus  ,tol.p   ), d.phosphorus);&quot;</span>;</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;k&#39;,    arrowSign(d.raw_potassium   ,d.potassium   ,tol.k   ), d.potassium);&quot;</span>;</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span> </div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>                     <span class="comment">// Recommendation arrows (target vs current)</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;temp_rec&#39;, arrowSign(d.temperature ,d.rec_temperature ,tol.temp), d.rec_temperature);&quot;</span>;</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;hum_rec&#39;,  arrowSign(d.humidity    ,d.rec_humidity    ,tol.hum ), d.rec_humidity);&quot;</span>;</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;ec_rec&#39;,   arrowSign(d.ec          ,d.rec_ec          ,tol.ec  ), d.rec_ec);&quot;</span>;</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;ph_rec&#39;,   arrowSign(d.ph          ,d.rec_ph          ,tol.ph  ), d.rec_ph);&quot;</span>;</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;n_rec&#39;,    arrowSign(d.nitrogen    ,d.rec_nitrogen    ,tol.n   ), d.rec_nitrogen);&quot;</span>;</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;p_rec&#39;,    arrowSign(d.phosphorus  ,d.rec_phosphorus  ,tol.p   ), d.rec_phosphorus);&quot;</span>;</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>                     html += <span class="stringliteral">&quot;showWithArrow(&#39;k_rec&#39;,    arrowSign(d.potassium   ,d.rec_potassium   ,tol.k   ), d.rec_potassium);&quot;</span>;</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>                     <span class="comment">// === End arrow indicators ===</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>                     </div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>                     <span class="comment">// Добавляем индикацию сезонных корректировок</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>                     html += <span class="stringliteral">&quot;function updateSeasonalAdjustments(season) {&quot;</span>;</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>                     html += <span class="stringliteral">&quot;  const adjustments = {&quot;</span>;</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>                     html += <span class="stringliteral">&quot;    &#39;Весна&#39;: { n: &#39;+20%&#39;, p: &#39;+15%&#39;, k: &#39;+10%&#39; },&quot;</span>;</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>                     html += <span class="stringliteral">&quot;    &#39;Лето&#39;: { n: &#39;-10%&#39;, p: &#39;+5%&#39;, k: &#39;+25%&#39; },&quot;</span>;</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>                     html += <span class="stringliteral">&quot;    &#39;Осень&#39;: { n: &#39;-20%&#39;, p: &#39;+10%&#39;, k: &#39;+15%&#39; },&quot;</span>;</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>                     html += <span class="stringliteral">&quot;    &#39;Зима&#39;: { n: &#39;-30%&#39;, p: &#39;+5%&#39;, k: &#39;+5%&#39; }&quot;</span>;</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>                     html += <span class="stringliteral">&quot;  };&quot;</span>;</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>                     html += <span class="stringliteral">&quot;  const envType = &quot;</span> + String(<a class="code hl_variable" href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a>.environmentType) + <span class="stringliteral">&quot;;&quot;</span>;</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>                     html += <span class="stringliteral">&quot;  if(envType === 1) {&quot;</span>; <span class="comment">// Теплица</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>                     html += <span class="stringliteral">&quot;    adjustments[&#39;Весна&#39;] = { n: &#39;+25%&#39;, p: &#39;+20%&#39;, k: &#39;+15%&#39; };&quot;</span>;</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>                     html += <span class="stringliteral">&quot;    adjustments[&#39;Лето&#39;] = { n: &#39;+10%&#39;, p: &#39;+10%&#39;, k: &#39;+30%&#39; };&quot;</span>;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>                     html += <span class="stringliteral">&quot;    adjustments[&#39;Осень&#39;] = { n: &#39;+15%&#39;, p: &#39;+15%&#39;, k: &#39;+20%&#39; };&quot;</span>;</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>                     html += <span class="stringliteral">&quot;    adjustments[&#39;Зима&#39;] = { n: &#39;+5%&#39;, p: &#39;+10%&#39;, k: &#39;+15%&#39; };&quot;</span>;</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>                     html += <span class="stringliteral">&quot;  }&quot;</span>;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>                     html += <span class="stringliteral">&quot;  const adj = adjustments[season] || { n: &#39;&#39;, p: &#39;&#39;, k: &#39;&#39; };&quot;</span>;</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>                     html += <span class="stringliteral">&quot;  [&#39;n&#39;, &#39;p&#39;, &#39;k&#39;].forEach(elem =&gt; {&quot;</span>;</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>                     html += <span class="stringliteral">&quot;    const span = document.getElementById(elem + &#39;_season&#39;);&quot;</span>;</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                     html += <span class="stringliteral">&quot;    if(span) {&quot;</span>;</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>                     html += <span class="stringliteral">&quot;      span.textContent = adj[elem] ? ` (${adj[elem]})` : &#39;&#39;;&quot;</span>;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>                     html += <span class="stringliteral">&quot;      span.className = &#39;season-adj &#39; + (adj[elem].startsWith(&#39;+&#39;) ? &#39;up&#39; : &#39;down&#39;);&quot;</span>;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>                     html += <span class="stringliteral">&quot;    }&quot;</span>;</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>                     html += <span class="stringliteral">&quot;  });&quot;</span>;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>                     html += <span class="stringliteral">&quot;}&quot;</span>;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>                     </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>                     html += <span class="stringliteral">&quot;var invalid = d.irrigation || d.alerts.length&gt;0 || d.humidity&lt;25 || d.temperature&lt;5 || d.temperature&gt;40;&quot;</span>;</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>                     html += <span class="stringliteral">&quot;var statusHtml = invalid ? &#39;&lt;span class=\\\&quot;red\\\&quot;&gt;Данные&amp;nbsp;не&amp;nbsp;валидны&lt;/span&gt;&#39; : &#39;&lt;span class=\\\&quot;green\\\&quot;&gt;Данные&amp;nbsp;валидны&lt;/span&gt;&#39;;&quot;</span>;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>                     html += <span class="stringliteral">&quot;var seasonColor={&#39;Лето&#39;:&#39;green&#39;,&#39;Весна&#39;:&#39;yellow&#39;,&#39;Осень&#39;:&#39;yellow&#39;,&#39;Зима&#39;:&#39;red&#39;,&#39;Н/Д&#39;:&#39;&#39;}[d.season]||&#39;&#39;;&quot;</span>;</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>                     html += <span class="stringliteral">&quot;var seasonHtml=seasonColor?(`&lt;span class=\\\&quot;${seasonColor}\\\&quot;&gt;${d.season}&lt;/span&gt;`):d.season;&quot;</span>;</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>                     html += <span class="stringliteral">&quot;document.getElementById(&#39;statusInfo&#39;).innerHTML=statusHtml+&#39; | Сезон: &#39;+seasonHtml;&quot;</span>;</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>                     html += <span class="stringliteral">&quot;updateSeasonalAdjustments(d.season);&quot;</span>;</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>                     html += <span class="stringliteral">&quot;var tvr=parseFloat(d.raw_temperature);applyColor(&#39;temp_raw&#39;,colorRange(tvr,limits.temp.min,limits.temp.max));&quot;</span>;</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>                     html += <span class="stringliteral">&quot;var hvr=parseFloat(d.raw_humidity);applyColor(&#39;hum_raw&#39;,colorRange(hvr,limits.hum.min,limits.hum.max));&quot;</span>;</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>                     html += <span class="stringliteral">&quot;var evr=parseFloat(d.raw_ec);applyColor(&#39;ec_raw&#39;,colorRange(evr,limits.ec.min,limits.ec.max));&quot;</span>;</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>                     html += <span class="stringliteral">&quot;var pvr=parseFloat(d.raw_ph);applyColor(&#39;ph_raw&#39;,colorRange(pvr,limits.ph.min,limits.ph.max));&quot;</span>;</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>                     html += <span class="stringliteral">&quot;var nvr=parseFloat(d.raw_nitrogen);applyColor(&#39;n_raw&#39;,colorRange(nvr,limits.n.min,limits.n.max));&quot;</span>;</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>                     html += <span class="stringliteral">&quot;var p2r=parseFloat(d.raw_phosphorus);applyColor(&#39;p_raw&#39;,colorRange(p2r,limits.p.min,limits.p.max));&quot;</span>;</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>                     html += <span class="stringliteral">&quot;var kvr=parseFloat(d.raw_potassium);applyColor(&#39;k_raw&#39;,colorRange(kvr,limits.k.min,limits.k.max));&quot;</span>;</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>                     html += <span class="stringliteral">&quot;[&#39;temp&#39;,&#39;hum&#39;,&#39;ec&#39;,&#39;ph&#39;,&#39;n&#39;,&#39;p&#39;,&#39;k&#39;].forEach(function(id){var el=document.getElementById(id);if(el){el.classList.remove(&#39;red&#39;,&#39;orange&#39;,&#39;yellow&#39;,&#39;green&#39;);}});&quot;</span>;</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>                     html += <span class="stringliteral">&quot;var ct=parseFloat(d.temperature);&quot;</span>;</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>                     html += <span class="stringliteral">&quot;var ch=parseFloat(d.humidity);&quot;</span>;</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>                     html += <span class="stringliteral">&quot;var ce=parseFloat(d.ec);&quot;</span>;</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>                     html += <span class="stringliteral">&quot;var cph=parseFloat(d.ph);&quot;</span>;</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>                     html += <span class="stringliteral">&quot;var cn=parseFloat(d.nitrogen);&quot;</span>;</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>                     html += <span class="stringliteral">&quot;var cp=parseFloat(d.phosphorus);&quot;</span>;</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>                     html += <span class="stringliteral">&quot;var ck=parseFloat(d.potassium);&quot;</span>;</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>                     html += <span class="stringliteral">&quot;applyColor(&#39;temp_rec&#39;, colorDelta(ct, parseFloat(d.rec_temperature)));&quot;</span>;</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>                     html += <span class="stringliteral">&quot;applyColor(&#39;hum_rec&#39;,  colorDelta(ch, parseFloat(d.rec_humidity)));&quot;</span>;</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>                     html += <span class="stringliteral">&quot;applyColor(&#39;ec_rec&#39;,   colorDelta(ce, parseFloat(d.rec_ec)));&quot;</span>;</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>                     html += <span class="stringliteral">&quot;applyColor(&#39;ph_rec&#39;,   colorDelta(cph,parseFloat(d.rec_ph)));&quot;</span>;</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>                     html += <span class="stringliteral">&quot;applyColor(&#39;n_rec&#39;,    colorDelta(cn, parseFloat(d.rec_nitrogen)));&quot;</span>;</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>                     html += <span class="stringliteral">&quot;applyColor(&#39;p_rec&#39;,    colorDelta(cp, parseFloat(d.rec_phosphorus)));&quot;</span>;</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>                     html += <span class="stringliteral">&quot;applyColor(&#39;k_rec&#39;,    colorDelta(ck, parseFloat(d.rec_potassium)));&quot;</span>;</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>                     html += <span class="stringliteral">&quot;});&quot;</span>;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>                     html += <span class="stringliteral">&quot;}&quot;</span>;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>                     html += <span class="stringliteral">&quot;setInterval(updateSensor,3000);&quot;</span>;</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>                     html += <span class="stringliteral">&quot;updateSensor();&quot;</span>;</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>                     html += <span class="stringliteral">&quot;&lt;/script&gt;&quot;</span>;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>                     </div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>                     <span class="comment">// API-ссылка внизу страницы</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>                     html += <span class="stringliteral">&quot;&lt;div style=&#39;margin-top:15px;font-size:14px;color:#555&#39;&gt;&lt;b&gt;API:&lt;/b&gt; &lt;a href=&#39;&quot;</span> + String(<a class="code hl_define" href="jxct__strings_8h.html#a47583d6152c2bf2cd0df1b41cd090268">API_SENSOR</a>) + <span class="stringliteral">&quot;&#39; target=&#39;_blank&#39;&gt;&quot;</span> + String(<a class="code hl_define" href="jxct__strings_8h.html#a47583d6152c2bf2cd0df1b41cd090268">API_SENSOR</a>) + <span class="stringliteral">&quot;&lt;/a&gt; (JSON, +timestamp)&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>                     </div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>                     html += <a class="code hl_function" href="web__templates_8cpp.html#ad4f3a6e85baef9b2d3e2aec977c3a321">generatePageFooter</a>();</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>                     <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.send(200, <span class="stringliteral">&quot;text/html; charset=utf-8&quot;</span>, html);</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>                 });</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span> </div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    <span class="comment">// AJAX эндпоинт для обновления показаний</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>    <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.on(<span class="stringliteral">&quot;/sensor_json&quot;</span>, HTTP_GET, <a class="code hl_function" href="routes__data_8cpp.html#a7cb04ca38fc8e4b768a2ef6ae67bc573">sendSensorJson</a>);</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span> </div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    <span class="comment">// Primary API v1 endpoint</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>    <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.on(<a class="code hl_define" href="jxct__strings_8h.html#a47583d6152c2bf2cd0df1b41cd090268">API_SENSOR</a>, HTTP_GET, <a class="code hl_function" href="routes__data_8cpp.html#a7cb04ca38fc8e4b768a2ef6ae67bc573">sendSensorJson</a>);</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span> </div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    <span class="comment">// Загрузка калибровочного CSV через вкладку</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>    <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.on(<span class="stringliteral">&quot;/readings/upload&quot;</span>, HTTP_POST, [](){}, <a class="code hl_function" href="routes__data_8cpp.html#a750e7ca088cd32f9490048becd8d8c70">handleReadingsUpload</a>);</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span> </div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>    <span class="comment">// Сброс пользовательских CSV (удаляем все *.csv)</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>    <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.on(<span class="stringliteral">&quot;/readings/csv_reset&quot;</span>, HTTP_POST,</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>                 []() {</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>                     <a class="code hl_function" href="error__handlers_8cpp.html#a1a62e7c40bff885d97f6018743bec642">logWebRequest</a>(<span class="stringliteral">&quot;POST&quot;</span>,<span class="stringliteral">&quot;/readings/csv_reset&quot;</span>, <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.client().remoteIP().toString());</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>                     <a class="code hl_function" href="namespace_calibration_manager.html#aee9fe56519e509e44d7f936a7a4c3613">CalibrationManager::init</a>();</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>                     <span class="keywordtype">bool</span> removed = <a class="code hl_function" href="namespace_calibration_manager.html#a14e21e7fb1aa46aa781c20ee07271d12">CalibrationManager::deleteTable</a>(<a class="code hl_enumvalue" href="sensor__compensation_8h.html#aaa92ab56ea828c0bcccad4564b21155dadd8b86e783c5b75c7c9224089b4f239b">SoilProfile::SAND</a>);</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>                     String toast = removed?<span class="stringliteral">&quot;CSV+удален&quot;</span>:<span class="stringliteral">&quot;CSV+не+найден&quot;</span>;</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>                     <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.sendHeader(<span class="stringliteral">&quot;Location&quot;</span>, String(<span class="stringliteral">&quot;/readings?toast=&quot;</span>) + toast, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>                     <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.send(302,<span class="stringliteral">&quot;text/plain&quot;</span>,<span class="stringliteral">&quot;Redirect&quot;</span>);</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>                 });</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span> </div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>    <span class="comment">// Форма для сохранения профиля</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>    <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.on(<span class="stringliteral">&quot;/readings/profile&quot;</span>, HTTP_POST, [](){}, <a class="code hl_function" href="routes__data_8cpp.html#abbd29afd9c684d507a0787906872c9d9">handleProfileSave</a>);</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span> </div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    <span class="comment">// Обслуживание статических файлов из LittleFS</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.on(<span class="stringliteral">&quot;/docs/examples/calibration_example.csv&quot;</span>, HTTP_GET,</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>                 []() {</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>                     <a class="code hl_function" href="error__handlers_8cpp.html#a1a62e7c40bff885d97f6018743bec642">logWebRequest</a>(<span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;/docs/examples/calibration_example.csv&quot;</span>, <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.client().remoteIP().toString());</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>                     </div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>                     <span class="keywordflow">if</span> (LittleFS.exists(<span class="stringliteral">&quot;/docs/examples/calibration_example.csv&quot;</span>)) {</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>                         File file = LittleFS.open(<span class="stringliteral">&quot;/docs/examples/calibration_example.csv&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>                         <span class="keywordflow">if</span> (file) {</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>                             <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.sendHeader(<span class="stringliteral">&quot;Content-Type&quot;</span>, <span class="stringliteral">&quot;text/csv&quot;</span>);</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>                             <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.sendHeader(<span class="stringliteral">&quot;Content-Disposition&quot;</span>, <span class="stringliteral">&quot;attachment; filename=\&quot;calibration_example.csv\&quot;&quot;</span>);</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>                             <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.streamFile(file, <span class="stringliteral">&quot;text/csv&quot;</span>);</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>                             file.close();</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>                         } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>                             <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.send(404, <span class="stringliteral">&quot;text/plain&quot;</span>, <span class="stringliteral">&quot;File not found&quot;</span>);</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>                         }</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>                     } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>                         <span class="comment">// Если файл не найден, создаем его на лету</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>                         <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.sendHeader(<span class="stringliteral">&quot;Content-Type&quot;</span>, <span class="stringliteral">&quot;text/csv&quot;</span>);</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>                         <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.sendHeader(<span class="stringliteral">&quot;Content-Disposition&quot;</span>, <span class="stringliteral">&quot;attachment; filename=\&quot;calibration_example.csv\&quot;&quot;</span>);</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>                         String csvContent = <span class="stringliteral">&quot;# Пример калибровочной таблицы для JXCT датчика\n&quot;</span>;</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>                         csvContent += <span class="stringliteral">&quot;# Формат: сырое_значение,коэффициент_коррекции\n&quot;</span>;</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>                         csvContent += <span class="stringliteral">&quot;# Коэффициент применяется как: скорректированное_значение = сырое_значение * коэффициент\n\n&quot;</span>;</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>                         csvContent += <span class="stringliteral">&quot;# Электропроводность (µS/cm) - может требовать коррекции\n&quot;</span>;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>                         csvContent += <span class="stringliteral">&quot;0,1.000\n&quot;</span>;</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>                         csvContent += <span class="stringliteral">&quot;500,0.98\n&quot;</span>;</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>                         csvContent += <span class="stringliteral">&quot;1000,0.95\n&quot;</span>;</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>                         csvContent += <span class="stringliteral">&quot;1500,0.93\n&quot;</span>;</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>                         csvContent += <span class="stringliteral">&quot;2000,0.91\n&quot;</span>;</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>                         csvContent += <span class="stringliteral">&quot;3000,0.89\n&quot;</span>;</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>                         csvContent += <span class="stringliteral">&quot;5000,0.87\n\n&quot;</span>;</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>                         csvContent += <span class="stringliteral">&quot;# pH - может требовать коррекции\n&quot;</span>;</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>                         csvContent += <span class="stringliteral">&quot;3.0,1.000\n&quot;</span>;</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>                         csvContent += <span class="stringliteral">&quot;4.0,1.000\n&quot;</span>;</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>                         csvContent += <span class="stringliteral">&quot;5.0,1.000\n&quot;</span>;</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>                         csvContent += <span class="stringliteral">&quot;6.0,1.000\n&quot;</span>;</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>                         csvContent += <span class="stringliteral">&quot;7.0,1.000\n&quot;</span>;</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>                         csvContent += <span class="stringliteral">&quot;8.0,1.000\n&quot;</span>;</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>                         csvContent += <span class="stringliteral">&quot;9.0,1.000\n\n&quot;</span>;</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>                         csvContent += <span class="stringliteral">&quot;# Азот (мг/кг) - может требовать коррекции\n&quot;</span>;</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>                         csvContent += <span class="stringliteral">&quot;0,1.000\n&quot;</span>;</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>                         csvContent += <span class="stringliteral">&quot;100,0.95\n&quot;</span>;</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>                         csvContent += <span class="stringliteral">&quot;200,0.92\n&quot;</span>;</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>                         csvContent += <span class="stringliteral">&quot;500,0.89\n&quot;</span>;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>                         csvContent += <span class="stringliteral">&quot;1000,0.87\n&quot;</span>;</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>                         csvContent += <span class="stringliteral">&quot;1500,0.85\n&quot;</span>;</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>                         <a class="code hl_variable" href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a>.send(200, <span class="stringliteral">&quot;text/csv&quot;</span>, csvContent);</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>                     }</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>                 });</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span> </div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>    <span class="comment">// Deprecated alias удалён в v2.7.0</span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span> </div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>    <a class="code hl_function" href="logger_8cpp.html#a1e536b98344ba271bbfc484cca848dbe">logDebug</a>(<span class="stringliteral">&quot;Маршруты данных настроены: /readings, /api/v1/sensor (json), /sensor_json [legacy]&quot;</span>);</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>}</div>
</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span> </div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span><span class="comment">// Вспомогательная функция для получения SSID точки доступа</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span><span class="keyword">extern</span> String <a class="code hl_function" href="routes__data_8cpp.html#af857f35623b29612a3b4cc45dd6fff23">getApSsid</a>();</div>
<div class="ttc" id="aconfig_8cpp_html_a4a8dd3a2de125b72d4fe6251a0a271b5"><div class="ttname"><a href="config_8cpp.html#a4a8dd3a2de125b72d4fe6251a0a271b5">config</a></div><div class="ttdeci">Config config</div><div class="ttdef"><b>Определения</b> <a href="config_8cpp_source.html#l00034">config.cpp:34</a></div></div>
<div class="ttc" id="aconfig_8cpp_html_a688d00bbabd28fbaf9e0c50eca3adeae"><div class="ttname"><a href="config_8cpp.html#a688d00bbabd28fbaf9e0c50eca3adeae">saveConfig</a></div><div class="ttdeci">void saveConfig()</div><div class="ttdef"><b>Определения</b> <a href="config_8cpp_source.html#l00128">config.cpp:128</a></div></div>
<div class="ttc" id="aerror__handlers_8cpp_html_a1a62e7c40bff885d97f6018743bec642"><div class="ttname"><a href="error__handlers_8cpp.html#a1a62e7c40bff885d97f6018743bec642">logWebRequest</a></div><div class="ttdeci">void logWebRequest(const String &amp;method, const String &amp;uri, const String &amp;clientIP)</div><div class="ttdoc">Логирование веб-запросов</div><div class="ttdef"><b>Определения</b> <a href="error__handlers_8cpp_source.html#l00152">error_handlers.cpp:152</a></div></div>
<div class="ttc" id="ajxct__config__vars_8h_html"><div class="ttname"><a href="jxct__config__vars_8h.html">jxct_config_vars.h</a></div></div>
<div class="ttc" id="ajxct__format__utils_8cpp_html_a39b2dedc3670adcf20a62a8d113d2483"><div class="ttname"><a href="jxct__format__utils_8cpp.html#a39b2dedc3670adcf20a62a8d113d2483">format_ec</a></div><div class="ttdeci">std::string format_ec(float value)</div><div class="ttdef"><b>Определения</b> <a href="jxct__format__utils_8cpp_source.html#l00018">jxct_format_utils.cpp:18</a></div></div>
<div class="ttc" id="ajxct__format__utils_8cpp_html_a3be478cef555484efe62159216f6d470"><div class="ttname"><a href="jxct__format__utils_8cpp.html#a3be478cef555484efe62159216f6d470">format_moisture</a></div><div class="ttdeci">std::string format_moisture(float value)</div><div class="ttdef"><b>Определения</b> <a href="jxct__format__utils_8cpp_source.html#l00004">jxct_format_utils.cpp:4</a></div></div>
<div class="ttc" id="ajxct__format__utils_8cpp_html_a416ab24406c338058778bbde7c4da152"><div class="ttname"><a href="jxct__format__utils_8cpp.html#a416ab24406c338058778bbde7c4da152">format_ph</a></div><div class="ttdeci">std::string format_ph(float value)</div><div class="ttdef"><b>Определения</b> <a href="jxct__format__utils_8cpp_source.html#l00025">jxct_format_utils.cpp:25</a></div></div>
<div class="ttc" id="ajxct__format__utils_8cpp_html_a9a843da2888c9b8014dd9506284f1351"><div class="ttname"><a href="jxct__format__utils_8cpp.html#a9a843da2888c9b8014dd9506284f1351">format_temperature</a></div><div class="ttdeci">std::string format_temperature(float value)</div><div class="ttdef"><b>Определения</b> <a href="jxct__format__utils_8cpp_source.html#l00011">jxct_format_utils.cpp:11</a></div></div>
<div class="ttc" id="ajxct__format__utils_8cpp_html_abdc9f6cdc05f0aa72eec54b3e904ca7b"><div class="ttname"><a href="jxct__format__utils_8cpp.html#abdc9f6cdc05f0aa72eec54b3e904ca7b">format_npk</a></div><div class="ttdeci">std::string format_npk(float value)</div><div class="ttdef"><b>Определения</b> <a href="jxct__format__utils_8cpp_source.html#l00032">jxct_format_utils.cpp:32</a></div></div>
<div class="ttc" id="ajxct__format__utils_8h_html"><div class="ttname"><a href="jxct__format__utils_8h.html">jxct_format_utils.h</a></div></div>
<div class="ttc" id="ajxct__strings_8h_html"><div class="ttname"><a href="jxct__strings_8h.html">jxct_strings.h</a></div></div>
<div class="ttc" id="ajxct__strings_8h_html_a47583d6152c2bf2cd0df1b41cd090268"><div class="ttname"><a href="jxct__strings_8h.html#a47583d6152c2bf2cd0df1b41cd090268">API_SENSOR</a></div><div class="ttdeci">#define API_SENSOR</div><div class="ttdef"><b>Определения</b> <a href="jxct__strings_8h_source.html#l00008">jxct_strings.h:8</a></div></div>
<div class="ttc" id="ajxct__ui__system_8cpp_html_a7834ec4c73014039a2aeeedadff41141"><div class="ttname"><a href="jxct__ui__system_8cpp.html#a7834ec4c73014039a2aeeedadff41141">generateButton</a></div><div class="ttdeci">String generateButton(ButtonType type, const char *icon, const char *text, const char *action)</div><div class="ttdef"><b>Определения</b> <a href="jxct__ui__system_8cpp_source.html#l00286">jxct_ui_system.cpp:286</a></div></div>
<div class="ttc" id="ajxct__ui__system_8h_html"><div class="ttname"><a href="jxct__ui__system_8h.html">jxct_ui_system.h</a></div></div>
<div class="ttc" id="ajxct__ui__system_8h_html_a075f0130a6ec13e19f3da60e46f893ef"><div class="ttname"><a href="jxct__ui__system_8h.html#a075f0130a6ec13e19f3da60e46f893ef">UI_ICON_DATA</a></div><div class="ttdeci">#define UI_ICON_DATA</div><div class="ttdef"><b>Определения</b> <a href="jxct__ui__system_8h_source.html#l00048">jxct_ui_system.h:48</a></div></div>
<div class="ttc" id="ajxct__ui__system_8h_html_a0de268b94c85f6f3363294f873e67096"><div class="ttname"><a href="jxct__ui__system_8h.html#a0de268b94c85f6f3363294f873e67096">UI_ICON_UPLOAD</a></div><div class="ttdeci">#define UI_ICON_UPLOAD</div><div class="ttdef"><b>Определения</b> <a href="jxct__ui__system_8h_source.html#l00045">jxct_ui_system.h:45</a></div></div>
<div class="ttc" id="ajxct__ui__system_8h_html_ae2d5c50fae96a83cc4f5974af78e6943a371b09d93ca01e09a42fbd5a2a423f8e"><div class="ttname"><a href="jxct__ui__system_8h.html#ae2d5c50fae96a83cc4f5974af78e6943a371b09d93ca01e09a42fbd5a2a423f8e">ButtonType::SECONDARY</a></div><div class="ttdeci">@ SECONDARY</div><div class="ttdef"><b>Определения</b> <a href="jxct__ui__system_8h_source.html#l00066">jxct_ui_system.h:66</a></div></div>
<div class="ttc" id="ajxct__ui__system_8h_html_ae2d5c50fae96a83cc4f5974af78e6943a428429ba9ea83e4841036fb0508fd6dc"><div class="ttname"><a href="jxct__ui__system_8h.html#ae2d5c50fae96a83cc4f5974af78e6943a428429ba9ea83e4841036fb0508fd6dc">ButtonType::PRIMARY</a></div><div class="ttdeci">@ PRIMARY</div><div class="ttdef"><b>Определения</b> <a href="jxct__ui__system_8h_source.html#l00065">jxct_ui_system.h:65</a></div></div>
<div class="ttc" id="alogger_8cpp_html_a1e536b98344ba271bbfc484cca848dbe"><div class="ttname"><a href="logger_8cpp.html#a1e536b98344ba271bbfc484cca848dbe">logDebug</a></div><div class="ttdeci">void logDebug(const char *format,...)</div><div class="ttdef"><b>Определения</b> <a href="logger_8cpp_source.html#l00112">logger.cpp:112</a></div></div>
<div class="ttc" id="alogger_8cpp_html_a54dab32db32234798ff063ccc0dde695"><div class="ttname"><a href="logger_8cpp.html#a54dab32db32234798ff063ccc0dde695">logSuccess</a></div><div class="ttdeci">void logSuccess(const char *format,...)</div><div class="ttdef"><b>Определения</b> <a href="logger_8cpp_source.html#l00129">logger.cpp:129</a></div></div>
<div class="ttc" id="alogger_8cpp_html_a60baa11f08afed73f5a7bc5d31f698ce"><div class="ttname"><a href="logger_8cpp.html#a60baa11f08afed73f5a7bc5d31f698ce">logError</a></div><div class="ttdeci">void logError(const char *format,...)</div><div class="ttdef"><b>Определения</b> <a href="logger_8cpp_source.html#l00061">logger.cpp:61</a></div></div>
<div class="ttc" id="alogger_8h_html"><div class="ttname"><a href="logger_8h.html">logger.h</a></div><div class="ttdoc">Система логгирования с красивым форматированием</div></div>
<div class="ttc" id="amain_8cpp_html_a22f33e7e05df58bb6145bb6e543e232a"><div class="ttname"><a href="main_8cpp.html#a22f33e7e05df58bb6145bb6e543e232a">ntpUDP</a></div><div class="ttdeci">WiFiUDP ntpUDP</div><div class="ttdef"><b>Определения</b> <a href="main_8cpp_source.html#l00042">main.cpp:42</a></div></div>
<div class="ttc" id="amain_8cpp_html_ab4cd0eb2684ad54d1d0782f4ff75e07f"><div class="ttname"><a href="main_8cpp.html#ab4cd0eb2684ad54d1d0782f4ff75e07f">timeClient</a></div><div class="ttdeci">NTPClient * timeClient</div><div class="ttdef"><b>Определения</b> <a href="main_8cpp_source.html#l00043">main.cpp:43</a></div></div>
<div class="ttc" id="amodbus__sensor_8cpp_html_ae6ed671f3036da58a93991fca2a2329c"><div class="ttname"><a href="modbus__sensor_8cpp.html#ae6ed671f3036da58a93991fca2a2329c">sensorData</a></div><div class="ttdeci">SensorData sensorData</div><div class="ttdef"><b>Определения</b> <a href="modbus__sensor_8cpp_source.html#l00018">modbus_sensor.cpp:18</a></div></div>
<div class="ttc" id="amodbus__sensor_8h_html"><div class="ttname"><a href="modbus__sensor_8h.html">modbus_sensor.h</a></div></div>
<div class="ttc" id="anamespace_calibration_manager_html_a14e21e7fb1aa46aa781c20ee07271d12"><div class="ttname"><a href="namespace_calibration_manager.html#a14e21e7fb1aa46aa781c20ee07271d12">CalibrationManager::deleteTable</a></div><div class="ttdeci">bool deleteTable(SoilProfile profile)</div><div class="ttdef"><b>Определения</b> <a href="calibration__manager_8cpp_source.html#l00100">calibration_manager.cpp:100</a></div></div>
<div class="ttc" id="anamespace_calibration_manager_html_a1ee0f1f244cb68eaa7e47a79deb452b6"><div class="ttname"><a href="namespace_calibration_manager.html#a1ee0f1f244cb68eaa7e47a79deb452b6">CalibrationManager::hasTable</a></div><div class="ttdeci">bool hasTable(SoilProfile profile)</div><div class="ttdef"><b>Определения</b> <a href="calibration__manager_8cpp_source.html#l00094">calibration_manager.cpp:94</a></div></div>
<div class="ttc" id="anamespace_calibration_manager_html_a24c0b11ea08e757ae404289fa38e33b3"><div class="ttname"><a href="namespace_calibration_manager.html#a24c0b11ea08e757ae404289fa38e33b3">CalibrationManager::profileToFilename</a></div><div class="ttdeci">const char * profileToFilename(SoilProfile)</div><div class="ttdef"><b>Определения</b> <a href="calibration__manager_8cpp_source.html#l00009">calibration_manager.cpp:9</a></div></div>
<div class="ttc" id="anamespace_calibration_manager_html_aee9fe56519e509e44d7f936a7a4c3613"><div class="ttname"><a href="namespace_calibration_manager.html#aee9fe56519e509e44d7f936a7a4c3613">CalibrationManager::init</a></div><div class="ttdeci">bool init()</div><div class="ttdef"><b>Определения</b> <a href="calibration__manager_8cpp_source.html#l00014">calibration_manager.cpp:14</a></div></div>
<div class="ttc" id="aroutes__calibration_8cpp_html_a0b77c83141abb779c6ed77f346019bc2"><div class="ttname"><a href="routes__calibration_8cpp.html#a0b77c83141abb779c6ed77f346019bc2">uploadProfile</a></div><div class="ttdeci">static SoilProfile uploadProfile</div><div class="ttdef"><b>Определения</b> <a href="routes__calibration_8cpp_source.html#l00080">routes_calibration.cpp:80</a></div></div>
<div class="ttc" id="aroutes__calibration_8cpp_html_a6385fd6a6118223757bf00a8ba828562"><div class="ttname"><a href="routes__calibration_8cpp.html#a6385fd6a6118223757bf00a8ba828562">webServer</a></div><div class="ttdeci">WebServer webServer</div></div>
<div class="ttc" id="aroutes__calibration_8cpp_html_a75f9cadda2a3d68252ebfeb55df86618"><div class="ttname"><a href="routes__calibration_8cpp.html#a75f9cadda2a3d68252ebfeb55df86618">uploadFile</a></div><div class="ttdeci">static File uploadFile</div><div class="ttdef"><b>Определения</b> <a href="routes__calibration_8cpp_source.html#l00079">routes_calibration.cpp:79</a></div></div>
<div class="ttc" id="aroutes__config_8cpp_html_afd1ea40c3b78acfa354aed81da58e582"><div class="ttname"><a href="routes__config_8cpp.html#afd1ea40c3b78acfa354aed81da58e582">currentWiFiMode</a></div><div class="ttdeci">WiFiMode currentWiFiMode</div><div class="ttdef"><b>Определения</b> <a href="wifi__manager_8cpp_source.html#l00026">wifi_manager.cpp:26</a></div></div>
<div class="ttc" id="aroutes__data_8cpp_html_a750e7ca088cd32f9490048becd8d8c70"><div class="ttname"><a href="routes__data_8cpp.html#a750e7ca088cd32f9490048becd8d8c70">handleReadingsUpload</a></div><div class="ttdeci">static void handleReadingsUpload()</div><div class="ttdef"><b>Определения</b> <a href="#l00137">routes_data.cpp:137</a></div></div>
<div class="ttc" id="aroutes__data_8cpp_html_a7cb04ca38fc8e4b768a2ef6ae67bc573"><div class="ttname"><a href="routes__data_8cpp.html#a7cb04ca38fc8e4b768a2ef6ae67bc573">sendSensorJson</a></div><div class="ttdeci">static void sendSensorJson()</div><div class="ttdef"><b>Определения</b> <a href="#l00186">routes_data.cpp:186</a></div></div>
<div class="ttc" id="aroutes__data_8cpp_html_abbd29afd9c684d507a0787906872c9d9"><div class="ttname"><a href="routes__data_8cpp.html#abbd29afd9c684d507a0787906872c9d9">handleProfileSave</a></div><div class="ttdeci">static void handleProfileSave()</div><div class="ttdef"><b>Определения</b> <a href="#l00169">routes_data.cpp:169</a></div></div>
<div class="ttc" id="aroutes__data_8cpp_html_ad30c0b8b33e60ccdb13f2e1cc08157c9"><div class="ttname"><a href="routes__data_8cpp.html#ad30c0b8b33e60ccdb13f2e1cc08157c9">navHtml</a></div><div class="ttdeci">String navHtml()</div><div class="ttdef"><b>Определения</b> <a href="wifi__manager_8cpp_source.html#l00082">wifi_manager.cpp:82</a></div></div>
<div class="ttc" id="aroutes__data_8cpp_html_adc35370b803782f896c844976a9ad6ce"><div class="ttname"><a href="routes__data_8cpp.html#adc35370b803782f896c844976a9ad6ce">formatValue</a></div><div class="ttdeci">String formatValue(float value, const char *unit, int precision)</div><div class="ttdef"><b>Определения</b> <a href="jxct__format__utils_8cpp_source.html#l00040">jxct_format_utils.cpp:40</a></div></div>
<div class="ttc" id="aroutes__data_8cpp_html_adc74086c185759ebabfbcd18b0abd9bd"><div class="ttname"><a href="routes__data_8cpp.html#adc74086c185759ebabfbcd18b0abd9bd">computeRecommendations</a></div><div class="ttdeci">static RecValues computeRecommendations()</div><div class="ttdef"><b>Определения</b> <a href="#l00034">routes_data.cpp:34</a></div></div>
<div class="ttc" id="aroutes__data_8cpp_html_aed1136f683a386e56678e05fc3747972"><div class="ttname"><a href="routes__data_8cpp.html#aed1136f683a386e56678e05fc3747972">setupDataRoutes</a></div><div class="ttdeci">void setupDataRoutes()</div><div class="ttdoc">Настройка маршрутов данных датчика (/readings, /sensor_json, /api/sensor)</div><div class="ttdef"><b>Определения</b> <a href="#l00274">routes_data.cpp:274</a></div></div>
<div class="ttc" id="aroutes__data_8cpp_html_af857f35623b29612a3b4cc45dd6fff23"><div class="ttname"><a href="routes__data_8cpp.html#af857f35623b29612a3b4cc45dd6fff23">getApSsid</a></div><div class="ttdeci">String getApSsid()</div><div class="ttdef"><b>Определения</b> <a href="wifi__manager_8cpp_source.html#l00206">wifi_manager.cpp:206</a></div></div>
<div class="ttc" id="asensor__compensation_8h_html_aaa92ab56ea828c0bcccad4564b21155d"><div class="ttname"><a href="sensor__compensation_8h.html#aaa92ab56ea828c0bcccad4564b21155d">SoilProfile</a></div><div class="ttdeci">SoilProfile</div><div class="ttdef"><b>Определения</b> <a href="sensor__compensation_8h_source.html#l00013">sensor_compensation.h:14</a></div></div>
<div class="ttc" id="asensor__compensation_8h_html_aaa92ab56ea828c0bcccad4564b21155dadd8b86e783c5b75c7c9224089b4f239b"><div class="ttname"><a href="sensor__compensation_8h.html#aaa92ab56ea828c0bcccad4564b21155dadd8b86e783c5b75c7c9224089b4f239b">SoilProfile::SAND</a></div><div class="ttdeci">@ SAND</div><div class="ttdef"><b>Определения</b> <a href="sensor__compensation_8h_source.html#l00015">sensor_compensation.h:15</a></div></div>
<div class="ttc" id="astruct_rec_values_html"><div class="ttname"><a href="struct_rec_values.html">RecValues</a></div><div class="ttdef"><b>Определения</b> <a href="#l00032">routes_data.cpp:32</a></div></div>
<div class="ttc" id="astruct_rec_values_html_a16338a277db1e53fc9f557a30777d3c5"><div class="ttname"><a href="struct_rec_values.html#a16338a277db1e53fc9f557a30777d3c5">RecValues::p</a></div><div class="ttdeci">float p</div><div class="ttdef"><b>Определения</b> <a href="#l00032">routes_data.cpp:32</a></div></div>
<div class="ttc" id="astruct_rec_values_html_a33f921599e1cd50cdd79c3a323ec726f"><div class="ttname"><a href="struct_rec_values.html#a33f921599e1cd50cdd79c3a323ec726f">RecValues::n</a></div><div class="ttdeci">float n</div><div class="ttdef"><b>Определения</b> <a href="#l00032">routes_data.cpp:32</a></div></div>
<div class="ttc" id="astruct_rec_values_html_a52e88e1a415453e74e04ab301231bdb6"><div class="ttname"><a href="struct_rec_values.html#a52e88e1a415453e74e04ab301231bdb6">RecValues::k</a></div><div class="ttdeci">float k</div><div class="ttdef"><b>Определения</b> <a href="#l00032">routes_data.cpp:32</a></div></div>
<div class="ttc" id="astruct_rec_values_html_a93613bd3e62e62e2e5348dbcdbf7141c"><div class="ttname"><a href="struct_rec_values.html#a93613bd3e62e62e2e5348dbcdbf7141c">RecValues::ec</a></div><div class="ttdeci">float ec</div><div class="ttdef"><b>Определения</b> <a href="#l00032">routes_data.cpp:32</a></div></div>
<div class="ttc" id="astruct_rec_values_html_ac357ff48495f333eaf3e2b92fd21cf43"><div class="ttname"><a href="struct_rec_values.html#ac357ff48495f333eaf3e2b92fd21cf43">RecValues::ph</a></div><div class="ttdeci">float ph</div><div class="ttdef"><b>Определения</b> <a href="#l00032">routes_data.cpp:32</a></div></div>
<div class="ttc" id="astruct_rec_values_html_ad5e68754a138f0b3d4a2fcc8a6d41846"><div class="ttname"><a href="struct_rec_values.html#ad5e68754a138f0b3d4a2fcc8a6d41846">RecValues::t</a></div><div class="ttdeci">float t</div><div class="ttdef"><b>Определения</b> <a href="#l00032">routes_data.cpp:32</a></div></div>
<div class="ttc" id="astruct_rec_values_html_af5f8d5f555bee5aa71f30afabce004fd"><div class="ttname"><a href="struct_rec_values.html#af5f8d5f555bee5aa71f30afabce004fd">RecValues::hum</a></div><div class="ttdeci">float hum</div><div class="ttdef"><b>Определения</b> <a href="#l00032">routes_data.cpp:32</a></div></div>
<div class="ttc" id="aweb__routes_8h_html"><div class="ttname"><a href="web__routes_8h.html">web_routes.h</a></div></div>
<div class="ttc" id="aweb__templates_8cpp_html_a1d57b5edf50f600cc5d02641cb4510a0"><div class="ttname"><a href="web__templates_8cpp.html#a1d57b5edf50f600cc5d02641cb4510a0">generateApModeUnavailablePage</a></div><div class="ttdeci">String generateApModeUnavailablePage(const String &amp;title, const String &amp;icon)</div><div class="ttdoc">Генерация страницы &quot;Недоступно в AP режиме&quot;.</div><div class="ttdef"><b>Определения</b> <a href="web__templates_8cpp_source.html#l00175">web_templates.cpp:175</a></div></div>
<div class="ttc" id="aweb__templates_8cpp_html_ac4502db1ad8d9e08830f7eb784d62600"><div class="ttname"><a href="web__templates_8cpp.html#ac4502db1ad8d9e08830f7eb784d62600">generatePageHeader</a></div><div class="ttdeci">String generatePageHeader(const String &amp;title, const String &amp;icon)</div><div class="ttdoc">Генерация заголовка HTML страницы</div><div class="ttdef"><b>Определения</b> <a href="web__templates_8cpp_source.html#l00008">web_templates.cpp:8</a></div></div>
<div class="ttc" id="aweb__templates_8cpp_html_ad4f3a6e85baef9b2d3e2aec977c3a321"><div class="ttname"><a href="web__templates_8cpp.html#ad4f3a6e85baef9b2d3e2aec977c3a321">generatePageFooter</a></div><div class="ttdeci">String generatePageFooter()</div><div class="ttdoc">Генерация футера HTML страницы</div><div class="ttdef"><b>Определения</b> <a href="web__templates_8cpp_source.html#l00019">web_templates.cpp:19</a></div></div>
<div class="ttc" id="awifi__manager_8h_html"><div class="ttname"><a href="wifi__manager_8h.html">wifi_manager.h</a></div></div>
<div class="ttc" id="awifi__manager_8h_html_ae685142b922ea26aa869f6cb5e17a19ca0fd3f8dd5edc33b28db1162e15e8fcbc"><div class="ttname"><a href="wifi__manager_8h.html#ae685142b922ea26aa869f6cb5e17a19ca0fd3f8dd5edc33b28db1162e15e8fcbc">WiFiMode::AP</a></div><div class="ttdeci">@ AP</div><div class="ttdef"><b>Определения</b> <a href="wifi__manager_8h_source.html#l00013">wifi_manager.h:13</a></div></div>
<div class="ttc" id="awifi__manager_8h_html_ae685142b922ea26aa869f6cb5e17a19ca971ab16c6e59a04d070cb8d8da13418e"><div class="ttname"><a href="wifi__manager_8h.html#ae685142b922ea26aa869f6cb5e17a19ca971ab16c6e59a04d070cb8d8da13418e">WiFiMode::STA</a></div><div class="ttdeci">@ STA</div><div class="ttdef"><b>Определения</b> <a href="wifi__manager_8h_source.html#l00014">wifi_manager.h:14</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_0d4dde2834ed44e47b6207c19e4aac26.html">web</a></li><li class="navelem"><a class="el" href="routes__data_8cpp.html">routes_data.cpp</a></li>
    <li class="footer">Документация по JXCT Soil Sensor 7-in-1. Последние изменения: Вт 24 Июн 2025 21:16:52. Создано системой <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
