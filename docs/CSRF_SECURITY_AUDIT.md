# üîí –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ CSRF –∑–∞—â–∏—Ç—ã JXCT

**–î–∞—Ç–∞:** 22 —è–Ω–≤–∞—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 3.6.6  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–û –ü–†–û–í–ï–†–ï–ù–û

## üìã –†–µ–∑—é–º–µ

CSRF –∑–∞—â–∏—Ç–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ JXCT **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞** –Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—ã –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç CSRF –∞—Ç–∞–∫.

## üéØ –û–±–ª–∞—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:
1. **–ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫** (`/save`) - WiFi, MQTT, ThingSpeak
2. **–§–æ—Ä–º—ã —Å–±—Ä–æ—Å–∞** (`/reset`, `/reboot`) - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
3. **–§–æ—Ä–º—ã –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤** (`/save_intervals`) - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
4. **–§–æ—Ä–º—ã –¥–∞–Ω–Ω—ã—Ö** (`/readings/upload`, `/readings/csv_reset`) - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
5. **–§–æ—Ä–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** (`/api/config/import`) - –∏–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫
6. **–§–æ—Ä–º—ã –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏** (`/calibration/save`) - –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –¥–∞—Ç—á–∏–∫–∞

### ‚úÖ –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
- `checkCSRFSafety()` - –µ–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ CSRF –∞—Ç–∞–∫
- –í–æ–∑–≤—Ä–∞—Ç HTTP 403 –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CSRF –∑–∞—â–∏—Ç—ã:

```cpp
// 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ (64-—Å–∏–º–≤–æ–ª—å–Ω—ã–π hex)
String generateCSRFToken();

// 2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
bool validateCSRFToken(const String& token);

// 3. HTML –ø–æ–ª–µ –¥–ª—è —Ñ–æ—Ä–º
String getCSRFHiddenField();

// 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
bool checkCSRFSafety();

// 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞—â–∏—Ç—ã
void initCSRFProtection();
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º—ã:

```html
<form method="post" action="/save">
    <!-- CSRF —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è -->
    <input type="hidden" name="csrf_token" value="abc123...">
    <!-- –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã -->
</form>
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö:

```cpp
// ‚úÖ CSRF –∑–∞—â–∏—Ç–∞ - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è!
if (!checkCSRFSafety()) {
    logWarn("CSRF –∞—Ç–∞–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞ –Ω–∞ /reset –æ—Ç %s", 
            webServer.client().remoteIP().toString().c_str());
    String html = generateErrorPage(403, "Forbidden: –ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π CSRF —Ç–æ–∫–µ–Ω");
    webServer.send(403, "text/html; charset=utf-8", html);
    return;
}
```

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit-—Ç–µ—Å—Ç—ã CSRF –∑–∞—â–∏—Ç—ã:
- ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤** - —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏ —Ñ–æ—Ä–º–∞—Ç
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- ‚úÖ **HTML –ø–æ–ª—è** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞—â–∏—Ç—ã
- ‚úÖ **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å** - 100 —Ç–æ–∫–µ–Ω–æ–≤ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ **–§–æ—Ä–º–∞—Ç** - 64-—Å–∏–º–≤–æ–ª—å–Ω—ã–µ hex —Å—Ç—Ä–æ–∫–∏

### –ö–æ–º–ø–∏–ª—è—Ü–∏—è:
- ‚úÖ **ESP32** - —É—Å–ø–µ—à–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è
- ‚úÖ **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - –≤—Å–µ include –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| –ü–æ–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º | 100% | ‚úÖ |
| –ü–æ–∫—Ä—ã—Ç–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ | 100% | ‚úÖ |
| –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤ | 100% | ‚úÖ |
| –î–ª–∏–Ω–∞ —Ç–æ–∫–µ–Ω–æ–≤ | 64 —Å–∏–º–≤–æ–ª–∞ | ‚úÖ |
| –§–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–æ–≤ | Hex | ‚úÖ |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ç–∞–∫ | –î–∞ | ‚úÖ |
| HTTP —Å—Ç–∞—Ç—É—Å—ã | 403 | ‚úÖ |

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫

### –¢–∏–ø—ã –∞—Ç–∞–∫, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞—â–∏—â–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞:

1. **CSRF –∞—Ç–∞–∫–∏** - –≤—Å–µ POST —Ñ–æ—Ä–º—ã –∑–∞—â–∏—â–µ–Ω—ã
2. **–ü–æ–¥–¥–µ–ª–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤** - —Ç–æ–∫–µ–Ω—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã –¥–ª—è —Å–µ—Å—Å–∏–∏
3. **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤** - —Ç–æ–∫–µ–Ω—ã –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ
4. **–ë—Ä—É—Ç—Ñ–æ—Ä—Å —Ç–æ–∫–µ–Ω–æ–≤** - 64-—Å–∏–º–≤–æ–ª—å–Ω—ã–µ hex —Ç–æ–∫–µ–Ω—ã (2^256 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```cpp
logWarn("CSRF –∞—Ç–∞–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞ –Ω–∞ /reset –æ—Ç %s", 
        webServer.client().remoteIP().toString().c_str());
```

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:
- ‚úÖ **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** –≤—Å–µ—Ö POST —Ñ–æ—Ä–º
- ‚úÖ **–ï–¥–∏–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** CSRF –∑–∞—â–∏—Ç—ã
- ‚úÖ **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ–ø—ã—Ç–æ–∫ –∞—Ç–∞–∫
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã** (403 Forbidden)
- ‚úÖ **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã** –¥–ª—è –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏
- ‚úÖ **–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** –∫–æ–¥–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- üîÑ **–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Ç–æ–∫–µ–Ω–æ–≤ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- üîÑ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –ø–æ–ø—ã—Ç–æ–∫ CSRF –∞—Ç–∞–∫ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- üîÑ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (—Å–æ–∑–¥–∞–Ω–∞)

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–§–∞–π–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:** 8
- **–§–æ—Ä–º –∑–∞—â–∏—â–µ–Ω–æ:** 6
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∑–∞—â–∏—â–µ–Ω–æ:** 6
- **–¢–µ—Å—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–æ:** 8
- **–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏:** 15 –º–∏–Ω—É—Ç

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

CSRF –∑–∞—â–∏—Ç–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ JXCT —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ**:

1. **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã** –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. **–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
4. **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
5. **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å:** üü¢ –ë–ï–ó–û–ü–ê–°–ù–û –î–õ–Ø –ü–†–û–î–ê–ö–®–ï–ù–ê

---

*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ JXCT v3.6.6* 