# –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ –ê–£–î–ò–¢–ê –ò –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê v2.4.2

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 11 –∏—é–Ω—è 2025  
**–í–µ—Ä—Å–∏—è:** v2.4.2 - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ OTA  
**–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ OTA –≤–Ω–µ–¥—Ä–µ–Ω–∏—é  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–ï–†–í–´–ô –≠–¢–ê–ü –ó–ê–í–ï–†–®–ï–ù

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê

### –ê–Ω–∞–ª–∏–∑ –ø–∞–º—è—Ç–∏ - ‚úÖ –ì–û–¢–û–í–û –ö OTA
```
Flash: 916,213 bytes (46.6% –æ—Ç 4MB)
RAM: 53,212 bytes (16.2% –æ—Ç 320KB)
–°–≤–æ–±–æ–¥–Ω–æ –¥–ª—è OTA: ~1.1MB (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
```

**–í—ã–≤–æ–¥:** –°–∏—Å—Ç–µ–º–∞ –∏–º–µ–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –∑–∞–ø–∞—Å –ø–∞–º—è—Ç–∏ –¥–ª—è OTA partition

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ delay() –≤—ã–∑–æ–≤—ã**

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ src/wifi_manager.cpp:**
```cpp
// –ë–´–õ–û: delay(500); 
// –°–¢–ê–õ–û: vTaskDelay(WIFI_RETRY_DELAY_MS / portTICK_PERIOD_MS);

// –ë–´–õ–û: delay(2000);
// –°–¢–ê–õ–û: vTaskDelay(CONFIG_SAVE_DELAY_MS / portTICK_PERIOD_MS);
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ src/modbus_sensor.cpp:**
```cpp  
// –ë–´–õ–û: delay(2), delay(100), delay(1000)
// –°–¢–ê–õ–û: vTaskDelay(X / portTICK_PERIOD_MS)
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ src/main.cpp:**
```cpp
// –ë–´–õ–û: esp_task_wdt_init(30, true);
// –°–¢–ê–õ–û: esp_task_wdt_init(WATCHDOG_TIMEOUT_SEC, true);
```

### 2. **–í—ã–Ω–µ—Å–µ–Ω—ã –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã**

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ include/jxct_config_vars.h:**
```cpp
#define HTTP_PORT 80
#define DNS_PORT 53  
#define LED_FAST_BLINK_MS 100
#define LED_SLOW_BLINK_MS 500
#define WIFI_MAX_ATTEMPTS 20
#define WIFI_RETRY_DELAY_MS 500
#define BUTTON_HOLD_TIME_MS 2000
#define CONFIG_SAVE_DELAY_MS 2000
#define WATCHDOG_TIMEOUT_SEC 30
#define OTA_WATCHDOG_TIMEOUT_SEC 60  // –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ OTA
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤–æ –≤—Å–µ—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–µ—Å—Ç–∞—Ö**

### 3. **–£—Å–ø–µ—à–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è**
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –†–∞–∑–º–µ—Ä –ø—Ä–æ—à–∏–≤–∫–∏ –æ—Å—Ç–∞–ª—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º (916KB)
- ‚úÖ –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ RAM –≤ –Ω–æ—Ä–º–µ (53KB)

---

## üìã –ü–õ–ê–ù –î–ê–õ–¨–ù–ï–ô–®–ï–ì–û –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê

### **–í–´–ü–û–õ–ù–ï–ù–û (1 –¥–µ–Ω—å):**
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã  
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è OTA (—É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π watchdog)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è

### **–ö –í–´–ü–û–õ–ù–ï–ù–ò–Æ (3 –¥–Ω—è):**

#### **–î–µ–Ω—å 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ HTML/CSS –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ CSS —Å—Ç–∏–ª–∏ –Ω–∞ getUnifiedCSS() –≤–µ–∑–¥–µ
- [ ] –≠–∫–æ–Ω–æ–º–∏—è ~6KB Flash –ø–∞–º—è—Ç–∏
- [ ] –†–∏—Å–∫: –ù–∏–∑–∫–∏–π

#### **–î–µ–Ω—å 3-4: –†–∞–∑–±–∏–≤–∫–∞ setupWebServer()**  
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É web_server/
- [ ] –†–∞–∑–±–∏—Ç—å 1000+ —Å—Ç—Ä–æ–∫ –Ω–∞ 6 –º–æ–¥—É–ª–µ–π –ø–æ 150 —Å—Ç—Ä–æ–∫
- [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ OTA –º–∞—Ä—à—Ä—É—Ç–æ–≤
- [ ] –†–∏—Å–∫: –°—Ä–µ–¥–Ω–∏–π (—Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

---

## üéØ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö OTA v2.5.0

### **–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:**
- ‚úÖ **–ü–∞–º—è—Ç—å:** 1.1MB —Å–≤–æ–±–æ–¥–Ω–æ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –£–±—Ä–∞–Ω—ã –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã
- ‚úÖ **Watchdog:** –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è OTA
- ‚úÖ **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã:** –í—Å–µ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤—ã–Ω–µ—Å–µ–Ω—ã
- ‚ö†Ô∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –¢—Ä–µ–±—É–µ—Ç —Ä–∞–∑–±–∏–≤–∫–∏ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

### **–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (3 –¥–Ω—è):**
- ‚úÖ **–ü–æ–ª–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å** –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ OTA
- ‚úÖ **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏** –ø–æ–ª–æ–º–∫–∏ –ø—Ä–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏ OTA

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ú–ï–°–¢–ê –î–õ–Ø OTA –í–ù–ï–î–†–ï–ù–ò–Ø

### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ OTA:**
1. **–£–≤–µ–ª–∏—á–∏—Ç—å watchdog –¥–æ 60 —Å–µ–∫** ‚úÖ –ì–æ—Ç–æ–≤–æ
   ```cpp
   esp_task_wdt_init(OTA_WATCHDOG_TIMEOUT_SEC, true);
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–π –ø–∞–º—è—Ç–∏** üìã –¢—Ä–µ–±—É–µ—Ç—Å—è
   ```cpp
   if (ESP.getFreeSketchSpace() < NEW_FIRMWARE_SIZE) {
       // –û—Ç–∫–ª–æ–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   }
   ```

3. **Backup –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** üìã –¢—Ä–µ–±—É–µ—Ç—Å—è
   ```cpp
   void backupConfig();
   void restoreConfig();
   ```

4. **Rollback –º–µ—Ö–∞–Ω–∏–∑–º** üìã –¢—Ä–µ–±—É–µ—Ç—Å—è
   ```cpp
   void markFirmwareValid();
   void rollbackFirmware();
   ```

### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ OTA:**
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–æ—à–∏–≤–∫–∏**
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞**  
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π**
4. **–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

---

## üìà –ú–ï–¢–†–ò–ö–ò –ö–ê–ß–ï–°–¢–í–ê –ö–û–î–ê

### **–î–æ –∞—É–¥–∏—Ç–∞:**
- **–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã:** 8 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö delay()
- **–ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞:** 15+ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- **–ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** setupWebServer() 1000+ —Å—Ç—Ä–æ–∫
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ CSS:** ~6KB –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞

### **–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–ø–∞:**
- **–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã:** ‚úÖ 0 (–≤—Å–µ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ vTaskDelay)  
- **–ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞:** ‚úÖ 0 (–≤—Å–µ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞—Ö)
- **–ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** ‚ö†Ô∏è –û—Å—Ç–∞–µ—Ç—Å—è (–ø–ª–∞–Ω —Ä–∞–∑–±–∏–≤–∫–∏ –≥–æ—Ç–æ–≤)
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ CSS:** ‚ö†Ô∏è –û—Å—Ç–∞–µ—Ç—Å—è (–±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –¥–µ–Ω—å 2)

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:**
–°–∏—Å—Ç–µ–º–∞ **–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–∞** –∏ **–≥–æ—Ç–æ–≤–∞ –∫ OTA –Ω–∞ 70%**. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.

### **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. **–î–µ–Ω—å 2:** –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ CSS –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (—ç–∫–æ–Ω–æ–º–∏—è Flash)
2. **–î–µ–Ω—å 3-4:** –ú–æ–¥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (—É–ø—Ä–æ—â–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
3. **–î–µ–Ω—å 5:** –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ OTA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### **–ü—Ä–æ–≥–Ω–æ–∑:**
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (4 –¥–Ω—è) —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –≤ **–∏–¥–µ–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏** –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ —Ä–∏—Å–∫–∞–º–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 100% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ OTA.

---

**–°–æ—Å—Ç–∞–≤–∏—Ç–µ–ª—å:** –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ v2.5.0  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 11 –∏—é–Ω—è 2025 - –ø–µ—Ä–≤—ã–π —ç—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω ‚úÖ 