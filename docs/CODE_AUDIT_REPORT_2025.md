# –û–¢–ß–ï–¢ –ê–£–î–ò–¢–ê –ö–û–î–ê - –ü–û–î–ì–û–¢–û–í–ö–ê –ö OTA v2.5.0

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 11 –∏—é–Ω—è 2025  
**–í–µ—Ä—Å–∏—è:** v2.4.1  
**–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π  

---

## üìä –ê–ù–ê–õ–ò–ó –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –ü–ê–ú–Ø–¢–ò

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
```
Flash: 742,393 bytes —Ç–µ–∫—Å—Ç + 196,144 –¥–∞–Ω–Ω—ã–µ = 938,537 bytes (47.7% –∏–∑ 4MB)
RAM: 28,489 bytes BSS (8.7% –∏–∑ 320KB)
–°–≤–æ–±–æ–¥–Ω–æ Flash: ~1.1MB –¥–ª—è OTA + –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ OTA
‚úÖ **–ì–û–¢–û–í–û –ö OTA** - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è:
- OTA partition (~1.5MB)
- –¢–µ–∫—É—â–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (~950KB) 
- –†–µ–∑–µ—Ä–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (~200KB)

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. **–ë–õ–û–ö–ò–†–£–Æ–©–ò–ï delay() –í–´–ó–û–í–´**
‚ùå **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç** - –≤–ª–∏—è–µ—Ç –Ω–∞ OTA —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

**–õ–æ–∫–∞—Ü–∏–∏:**
```cpp
// src/wifi_manager.cpp:238
delay(500);  // –ë–ª–æ–∫–∏—Ä—É–µ—Ç WiFi –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

// src/wifi_manager.cpp:508,799,816,833  
delay(2000); // –ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤–µ–±-–æ—Ç–≤–µ—Ç—ã

// src/modbus_sensor.cpp:46,51,86
delay(2), delay(1000), delay(100) // –ë–ª–æ–∫–∏—Ä—É–µ—Ç Modbus
```

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ vTaskDelay() –∏–ª–∏ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ —Å—á–µ—Ç—á–∏–∫–∏

### 2. **–ú–ê–°–°–ò–í–ù–û–ï –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï CSS –ö–û–î–ê**
‚ùå **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç** - —Ä–∞—Å—Ö–æ–¥ Flash –ø–∞–º—è—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ CSS —Å—Ç–∏–ª–∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –≤ –∫–∞–∂–¥–æ–π HTML-—Ñ—É–Ω–∫—Ü–∏–∏
- ~400 –±–∞–π—Ç CSS √ó 15 —Ñ—É–Ω–∫—Ü–∏–π = **6KB –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**
- –û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö handleRoot(), sendAuthForm()

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å getUnifiedCSS() –≤–µ–∑–¥–µ

### 3. **–ú–û–ù–û–õ–ò–¢–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø setupWebServer()**
‚ùå **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç** - —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** 1000+ —Å—Ç—Ä–æ–∫ –≤ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, —Å–ª–æ–∂–Ω–æ—Å—Ç—å >15
**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–±–∏—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤

---

## üîç –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –î–û–õ–ì

### String –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è
‚ö†Ô∏è **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ê–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ String –¥–ª—è HTML-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
```cpp
String html = "<!DOCTYPE html>...";
html += navHtml();
html += "<h1>...";  // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏
```

**–†–∏—Å–∫:** –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è heap –≤ ESP32
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—É—Ñ–µ—Ä—ã –∏–ª–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é –æ—Ç–¥–∞—á—É

### –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞
‚ö†Ô∏è **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è:**
```cpp
WebServer webServer(80);         // HTTP_PORT
ledBlinkInterval = 100;          // LED_FAST_BLINK_MS  
attempts < 20                    // WIFI_MAX_ATTEMPTS
buttonPressed && (millis() - buttonPressTime >= 2000)  // BUTTON_HOLD_TIME_MS
```

### –ù–∞—Ä—É—à–µ–Ω–∏–µ DRY –ø—Ä–∏–Ω—Ü–∏–ø–∞
‚ö†Ô∏è **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**

1. **HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ 15+ —Ñ—É–Ω–∫—Ü–∏—è—Ö
2. **HTTP headers** –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤–µ–∑–¥–µ  
3. **JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** —Å—Ö–æ–∂–∏ –≤ —Ä–∞–∑–Ω—ã—Ö API

---

## üéØ –ü–õ–ê–ù –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê

### **–≠–¢–ê–ü 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**
**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å | **–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π

1. **–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ delay()**
   ```cpp
   // –ó–∞–º–µ–Ω–∏—Ç—å
   delay(500);
   // –ù–∞
   vTaskDelay(500 / portTICK_PERIOD_MS);
   ```

2. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å CSS**
   ```cpp
   // –í–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
   html += "<style>" + String(getUnifiedCSS()) + "</style>";
   ```

3. **–í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã**
   ```cpp
   // include/jxct_config_vars.h
   #define HTTP_PORT 80
   #define LED_FAST_BLINK_MS 100
   #define WIFI_MAX_ATTEMPTS 20
   #define BUTTON_HOLD_TIME_MS 2000
   ```

### **–≠–¢–ê–ü 2: –†–ê–ó–ë–ò–í–ö–ê –ú–û–ù–û–õ–ò–¢–ù–´–• –§–£–ù–ö–¶–ò–ô**  
**–í—Ä–µ–º—è:** 2 –¥–Ω—è | **–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π

1. **setupWebServer() ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏**
   ```cpp
   void setupWebRoutes() {
       webServer.on("/", handleRoot);
       webServer.on("/save", handleSave);
       webServer.on("/readings", handleReadings);
       // –∏ —Ç.–¥.
   }
   ```

2. **–í—ã–¥–µ–ª–∏—Ç—å –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏**
   ```cpp
   String buildHTMLTemplate(const String& title, const String& content);
   void sendJSONResponse(int code, const JsonDocument& doc);
   ```

### **–≠–¢–ê–ü 3: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ü–ê–ú–Ø–¢–ò**
**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å | **–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π  

1. **–ó–∞–º–µ–Ω–∏—Ç—å String –Ω–∞ –±—É—Ñ–µ—Ä—ã**
   ```cpp
   // –í–º–µ—Å—Ç–æ String –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏
   char htmlBuffer[2048];
   snprintf(htmlBuffer, sizeof(htmlBuffer), template, args...);
   ```

2. **–£–º–µ–Ω—å—à–∏—Ç—å JSON –±—É—Ñ–µ—Ä—ã**
   ```cpp
   StaticJsonDocument<256> doc;  // –≤–º–µ—Å—Ç–æ 1024
   ```

---

## üõ°Ô∏è –†–ò–°–ö–û–í–ê–ù–ù–´–ï –ú–ï–°–¢–ê

### **–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è**
1. **src/wifi_manager.cpp:316-1300** - setupWebServer()
   - **–†–∏—Å–∫:** –ü–æ–ª–æ–º–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤

2. **src/modbus_sensor.cpp:338-400** - realSensorTask()  
   - **–†–∏—Å–∫:** –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–∞
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏

### **–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è**
1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** (checkWebAuth)
   - **–†–∏—Å–∫:** –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** Fallback –º–µ—Ö–∞–Ω–∏–∑–º

2. **LED –∏–Ω–¥–∏–∫–∞—Ü–∏—è** 
   - **–†–∏—Å–∫:** –ü–æ—Ç–µ—Ä—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤

---

## üìà –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### **–ü–µ—Ä–µ–¥ OTA –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º**
1. ‚úÖ **–£–≤–µ–ª–∏—á–∏—Ç—å Watchdog** –¥–æ 60 —Å–µ–∫ –¥–ª—è OTA
2. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–≤–æ–±–æ–¥–Ω–æ–π –ø–∞–º—è—Ç–∏** –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º  
3. ‚úÖ **–°–æ–∑–¥–∞—Ç—å backup –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** –≤ SPIFFS
4. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å rollback** –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

### **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**
1. **–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –±–æ–ª—å—à–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ PROGMEM**
   ```cpp
   const char HTML_TEMPLATE[] PROGMEM = "<!DOCTYPE html>...";
   ```

2. **–ö–æ–º–ø—Ä–µ—Å—Å–∏—è –≤–µ–±-—Ä–µ—Å—É—Ä—Å–æ–≤**
   - –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è CSS/JS
   - GZIP —Å–∂–∞—Ç–∏–µ HTTP –æ—Ç–≤–µ—Ç–æ–≤

3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä**
   - –ó–∞–º–µ–Ω–∞ WebServer –Ω–∞ ESPAsyncWebServer
   - –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**
1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
   ```
   WiFiManager ‚Üí —Ç–æ–ª—å–∫–æ WiFi
   WebServer ‚Üí —Ç–æ–ª—å–∫–æ HTTP  
   ConfigManager ‚Üí —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   ```

2. **Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
   - –°–æ–±—ã—Ç–∏—è –≤–º–µ—Å—Ç–æ polling
   - –û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

---

## üîß –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –†–ê–ó–†–ê–ë–û–¢–ö–ï

### **–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å**
- ‚úÖ **–ü–∞–º—è—Ç—å:** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è OTA (1.1MB —Å–≤–æ–±–æ–¥–Ω–æ)
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** Watchdog –∏ FreeRTOS –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚ö†Ô∏è **–ö–æ–¥:** –¢—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤
- ‚ö†Ô∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ —Ä–∞–∑–±–∏–≤–∫–µ

### **–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞**  
- ‚úÖ **–ü–æ–ª–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å** –∫ OTA —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- ‚úÖ **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏** –ø–æ–ª–æ–º–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- ‚úÖ **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

**–ò–¢–û–ì–û:** –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ OTA –≤–Ω–µ–¥—Ä–µ–Ω–∏—é –ø–æ—Å–ª–µ 4 –¥–Ω–µ–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

---

**–°–æ—Å—Ç–∞–≤–∏—Ç–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 11 –∏—é–Ω—è 2025 