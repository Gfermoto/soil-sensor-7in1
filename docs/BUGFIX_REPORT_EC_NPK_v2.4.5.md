# üêõ –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò –ë–ê–ì–ê: EC –∏ NPK –ø–æ–∫–∞–∑–∞–Ω–∏—è —Ä–∞–≤–Ω—ã –Ω—É–ª—é

**–î–∞—Ç–∞:** 2024-12-30  
**–í–µ—Ä—Å–∏—è:** v2.4.5  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù

---

## üéØ –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

### ‚ùå **–°–∏–º–ø—Ç–æ–º—ã:**
- EC (—ç–ª–µ–∫—Ç—Ä–æ–ø—Ä–æ–≤–æ–¥–Ω–æ—Å—Ç—å) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 ¬µS/cm
- –ê–∑–æ—Ç (N) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 –º–≥/–∫–≥  
- –§–æ—Å—Ñ–æ—Ä (P) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 –º–≥/–∫–≥
- –ö–∞–ª–∏–π (K) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 –º–≥/–∫–≥
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ –≤–ª–∞–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üîç **–ü—Ä–∏—á–∏–Ω–∞:**
–ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ —Ñ—É–Ω–∫—Ü–∏–∏ `readSensorData()` –±—ã–ª–∞ –¥–æ–ø—É—â–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ —Ç–∏–ø–∞—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `readSingleRegister()`. 

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥:**
```cpp
// –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–ø–∏—Å–∞—Ç—å float –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∫ uint16_t
if (readSingleRegister(REG_CONDUCTIVITY, "EC", 1.0f, &sensorData.ec, false))  // ‚ùå false = uint16_t
if (readSingleRegister(REG_NITROGEN, "–ê–∑–æ—Ç", 1.0f, &sensorData.nitrogen, false))  // ‚ùå false = uint16_t
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```cpp
struct SensorData {
    float ec;           // ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ float
    float nitrogen;     // ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ float  
    float phosphorus;   // ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ float
    float potassium;    // ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ float
};
```

**–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Ç–∏–ø–æ–≤:**
- –ü–æ–ª—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ: `float` (4 –±–∞–π—Ç–∞)
- –ó–∞–ø–∏—Å—å –≤ —Ñ—É–Ω–∫—Ü–∏–∏: `uint16_t` (2 –±–∞–π—Ç–∞)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö ‚Üí –Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:**
```cpp
// –ü–†–ê–í–ò–õ–¨–ù–û: –∑–∞–ø–∏—Å—ã–≤–∞–µ–º float –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∫ float
if (readSingleRegister(REG_CONDUCTIVITY, "EC", 1.0f, &sensorData.ec, true))      // ‚úÖ true = float
if (readSingleRegister(REG_NITROGEN, "–ê–∑–æ—Ç", 1.0f, &sensorData.nitrogen, true))  // ‚úÖ true = float
if (readSingleRegister(REG_PHOSPHORUS, "–§–æ—Å—Ñ–æ—Ä", 1.0f, &sensorData.phosphorus, true))  // ‚úÖ true = float
if (readSingleRegister(REG_POTASSIUM, "–ö–∞–ª–∏–π", 1.0f, &sensorData.potassium, true))     // ‚úÖ true = float
```

### üìù **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö:**

#### `src/modbus_sensor.cpp`:
```diff
// EC (–±–µ–∑ –¥–µ–ª–µ–Ω–∏—è)
- if (readSingleRegister(REG_CONDUCTIVITY, "EC", 1.0f, &sensorData.ec, false))
+ if (readSingleRegister(REG_CONDUCTIVITY, "EC", 1.0f, &sensorData.ec, true))

// –ê–∑–æ—Ç
- if (readSingleRegister(REG_NITROGEN, "–ê–∑–æ—Ç", 1.0f, &sensorData.nitrogen, false))
+ if (readSingleRegister(REG_NITROGEN, "–ê–∑–æ—Ç", 1.0f, &sensorData.nitrogen, true))

// –§–æ—Å—Ñ–æ—Ä  
- if (readSingleRegister(REG_PHOSPHORUS, "–§–æ—Å—Ñ–æ—Ä", 1.0f, &sensorData.phosphorus, false))
+ if (readSingleRegister(REG_PHOSPHORUS, "–§–æ—Å—Ñ–æ—Ä", 1.0f, &sensorData.phosphorus, true))

// –ö–∞–ª–∏–π
- if (readSingleRegister(REG_POTASSIUM, "–ö–∞–ª–∏–π", 1.0f, &sensorData.potassium, false))
+ if (readSingleRegister(REG_POTASSIUM, "–ö–∞–ª–∏–π", 1.0f, &sensorData.potassium, true))
```

#### `include/validation_utils.h`:
```diff
// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
struct SensorData {
    float temperature;
    float humidity;
    float ph;
-   uint16_t ec;
-   uint16_t nitrogen;
-   uint16_t phosphorus;
-   uint16_t potassium;
+   float ec;           // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å float
+   float nitrogen;     // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å float
+   float phosphorus;   // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å float
+   float potassium;    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å float
};

// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞—Ç—É—Ä —Ñ—É–Ω–∫—Ü–∏–π
- ValidationResult validateEC(uint16_t ec);
- ValidationResult validateNPK(uint16_t value, const char* nutrient);
+ ValidationResult validateEC(float ec);
+ ValidationResult validateNPK(float value, const char* nutrient);
```

#### `src/validation_utils.cpp`:
```diff
// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ValidationResult validateEC(uint16_t ec)
+ ValidationResult validateEC(float ec)

- ValidationResult validateNPK(uint16_t value, const char* nutrient)
+ ValidationResult validateNPK(float value, const char* nutrient)
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### üîç **–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **–ß—Ç–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫–∞** ‚úÖ
   - `readSingleRegister()` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç float –∑–Ω–∞—á–µ–Ω–∏—è
   - –í—Å–µ 7 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–∏—Ç–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** ‚úÖ
   - `format_ec()` –∏ `format_npk()` –ø—Ä–∏–Ω–∏–º–∞—é—Ç float
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

3. **MQTT –ø—É–±–ª–∏–∫–∞—Ü–∏—è** ‚úÖ
   - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è `(int)round(sensorData.ec)` —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - Home Assistant –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

4. **ThingSpeak** ‚úÖ
   - `format_ec()` –∏ `format_npk()` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

5. **–í–∞–ª–∏–¥–∞—Ü–∏—è** ‚úÖ
   - –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è float —Ç–∏–ø–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### üìä **–ö–æ–º–ø–∏–ª—è—Ü–∏—è:**
```
RAM:   [==        ]  16.4% (used 53740 bytes from 327680 bytes)
Flash: [=====     ]  47.0% (used 923537 bytes from 1966080 bytes)
‚úÖ SUCCESS - –±–µ–∑ –æ—à–∏–±–æ–∫
```

---

## üõ°Ô∏è –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –ü–û–í–¢–û–†–ï–ù–ò–Ø

### üìã **–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

1. **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –í—Å–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
   - –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–º —Ç–∏–ø–∞–º

2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ —Ç–∏–ø–∞—Ö –¥–∞–Ω–Ω—ã—Ö
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### üîÆ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

1. **Code Review:**
   - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ
   - –í–Ω–∏–º–∞–Ω–∏–µ –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã:**
   - Unit —Ç–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π —á—Ç–µ–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

3. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤
   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Ç–∏–ø–æ–≤

---

## üìà –†–ï–ó–£–õ–¨–¢–ê–¢

### ‚úÖ **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ EC –ø–æ–∫–∞–∑–∞–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (0-20000 ¬µS/cm)
- ‚úÖ –ê–∑–æ—Ç –ø–æ–∫–∞–∑–∞–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (0-2000 –º–≥/–∫–≥)
- ‚úÖ –§–æ—Å—Ñ–æ—Ä –ø–æ–∫–∞–∑–∞–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (0-2000 –º–≥/–∫–≥)  
- ‚úÖ –ö–∞–ª–∏–π –ø–æ–∫–∞–∑–∞–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (0-2000 –º–≥/–∫–≥)
- ‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ MQTT –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ ThingSpeak –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ Home Assistant –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

### üéØ **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**
- ‚úÖ –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üèÅ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ —Å –Ω—É–ª–µ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ EC –∏ NPK –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω.**

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤—ã–∑–≤–∞–Ω–∞ –æ—à–∏–±–∫–æ–π —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏ float –∑–Ω–∞—á–µ–Ω–∏–π –∫–∞–∫ uint16_t. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–ª—é—á–∞–ª–æ—Å—å –≤ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–ª–∞–≥–∞ `is_float` —Å `false` –Ω–∞ `true` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–µ–π.

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–ª–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

---

**–ò—Å–ø—Ä–∞–≤–∏–ª:** AI Assistant  
**–ü—Ä–æ–≤–µ—Ä–∏–ª:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£ 