;
; JXCT Soil Sensor v2.0.1 - Professional IoT Solution
; Author: JXCT Development Team  
; Version: 2.0.1
; Last Updated: June 2025
; License: MIT
;

; Default environment for development
[platformio]
default_envs = esp32dev

; =============================================================================
; üõ†Ô∏è DEVELOPMENT CONFIGURATION - –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏
; =============================================================================
[env:esp32dev]
platform = espressif32 @ ^6.3.0
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
board_build.partitions = min_spiffs.csv

; Project metadata and development flags
build_flags = 
  -D JXCT_VERSION="2.0.1"
  -D JXCT_BUILD_DATE='"2025-06-10"'
  -D MQTT_MAX_PACKET_SIZE=1024
  -D MQTT_KEEPALIVE=60
  -D MQTT_SOCKET_TIMEOUT=15
  -D LED_BUILTIN=2
  -D BOOT_BUTTON=0
  -D DEBUG_MODE         ; –û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º
  -D INFO_MODE          ; –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  ; –ë–∞–∑–æ–≤—ã–µ FreeRTOS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  -D ARDUINO_LOOP_STACK_SIZE=6144  ; –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Å—Ç–µ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  -D CONFIG_FREERTOS_HZ=1000       ; –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å —Ç–∞–π–º–∏–Ω–≥–∞

; Core libraries
lib_deps =
  knolleary/PubSubClient @ ^2.8
  bblanchon/ArduinoJson @ ^6.21.4
  4-20ma/ModbusMaster @ ^2.0.1
  arduino-libraries/NTPClient @ ^3.2.1
  mathworks/ThingSpeak @ ^2.1.1

; Debugging tools
monitor_filters = esp32_exception_decoder

; =============================================================================
; üöÄ PRODUCTION RELEASE - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è production
; =============================================================================
[env:esp32dev-release]
extends = env:esp32dev
build_type = release
build_flags = 
  -D JXCT_VERSION="2.0.1"
  -D JXCT_BUILD_DATE='"2025-06-10"'
  -D MQTT_MAX_PACKET_SIZE=1024
  -D MQTT_KEEPALIVE=60
  -D MQTT_SOCKET_TIMEOUT=15
  -D LED_BUILTIN=2
  -D BOOT_BUTTON=0
  ; –ù–ï –æ–ø—Ä–µ–¥–µ–ª—è–µ–º DEBUG_MODE –¥–ª—è production
  -D NDEBUG
  
  ; ‚ö° –§–ª–∞–≥–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ (–Ω–∞ –æ—Å–Ω–æ–≤–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤)
  -O3                    ; –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
  -ffast-math           ; –ë—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π
  -funroll-loops        ; –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —Ü–∏–∫–ª–æ–≤
  -fomit-frame-pointer  ; –£–±–∏—Ä–∞–µ–º frame pointer
  -finline-functions    ; –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –∏–Ω–ª–∞–π–Ω–∏–Ω–≥
  -ffunction-sections   ; –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
  -fdata-sections       ; –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  
  ; üîã –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
  -D CONFIG_LOG_DEFAULT_LEVEL=1   ; –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  -D CORE_DEBUG_LEVEL=0           ; –û—Ç–∫–ª—é—á–∞–µ–º debug Arduino Core
  -D DEBUG_ESP_PORT=              ; –û—Ç–∫–ª—é—á–∞–µ–º ESP debug output
  
  ; üöÄ FreeRTOS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ª—É—á—à–∏–µ –∏–∑ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤)
  -D ARDUINO_LOOP_STACK_SIZE=4096                    ; –≠–∫–æ–Ω–æ–º–∏—è RAM
  -D CONFIG_FREERTOS_HZ=1000                         ; –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å —Ç–∞–π–º–∏–Ω–≥–∞
  -D CONFIG_FREERTOS_VTASKLIST_INCLUDE_COREID=0      ; –û—Ç–∫–ª—é—á–∏—Ç—å Core ID 
  -D CONFIG_FREERTOS_GENERATE_RUN_TIME_STATS=0       ; –û—Ç–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  -D CONFIG_FREERTOS_CHECK_STACKOVERFLOW=0           ; –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ stack
  -D CONFIG_FREERTOS_ASSERT_ON_UNTESTED_FUNCTION=0   ; –û—Ç–∫–ª—é—á–∏—Ç—å assert'—ã
  -D CONFIG_FREERTOS_HEAP_TASK_TRACKING=0            ; –û—Ç–∫–ª—é—á–∏—Ç—å heap tracking
  -D CONFIG_FREERTOS_MAX_TASK_NAME_LEN=8             ; –ö–æ—Ä–æ—Ç–∫–∏–µ –∏–º–µ–Ω–∞ –∑–∞–¥–∞—á
  -D CONFIG_FREERTOS_TIMER_TASK_STACK_DEPTH=1024     ; –£–º–µ–Ω—å—à–∏—Ç—å —Å—Ç–µ–∫ timer task
  -D CONFIG_FREERTOS_TIMER_QUEUE_LENGTH=5            ; –ú–µ–Ω—å—à–∞—è –æ—á–µ—Ä–µ–¥—å —Ç–∞–π–º–µ—Ä–æ–≤

build_unflags = 
  -fno-exceptions       ; –£–±–∏—Ä–∞–µ–º overhead –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
  -fstack-protector     ; –£–±–∏—Ä–∞–µ–º –∑–∞—â–∏—Ç—É —Å—Ç–µ–∫–∞

; –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–ª–∞–≥–∏ –ª–∏–Ω–∫–µ—Ä–∞
board_build.ldflags = 
  -Wl,--gc-sections      ; –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–µ–∫—Ü–∏–π
  -Wl,-O2               ; –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ª–∏–Ω–∫–µ—Ä–∞
  -Wl,--relax           ; –õ–∏–Ω–∫–µ—Ä–Ω–∞—è —Ä–µ–ª–∞–∫—Å–∞—Ü–∏—è 