;
; JXCT Soil Sensor v2.0.1 - Professional IoT Solution
; Author: JXCT Development Team  
; Version: 2.0.1
; Last Updated: June 2025
; License: MIT
;

; Default environment for development
[platformio]
default_envs = esp32dev

[env:esp32dev]
platform = espressif32 @ ^6.3.0
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
board_build.partitions = min_spiffs.csv

; Project metadata
build_flags = 
  -D JXCT_VERSION="2.0.1"
  -D JXCT_BUILD_DATE='"2025-06-10"'
  -D MQTT_MAX_PACKET_SIZE=1024
  -D MQTT_KEEPALIVE=60
  -D MQTT_SOCKET_TIMEOUT=15
  -D LED_BUILTIN=2
  -D BOOT_BUTTON=0
  -D DEBUG_MODE         ; Отладочный режим для разработки
  -D INFO_MODE          ; Информационные сообщения

; Core libraries
lib_deps =
  knolleary/PubSubClient @ ^2.8
  bblanchon/ArduinoJson @ ^6.21.4
  4-20ma/ModbusMaster @ ^2.0.1
  arduino-libraries/NTPClient @ ^3.2.1
  mathworks/ThingSpeak @ ^2.1.1

; Debugging and development
monitor_filters = esp32_exception_decoder

; Production build with maximum optimization
[env:esp32dev-release]
extends = env:esp32dev
build_type = release
build_flags = 
  -D JXCT_VERSION="2.0.1"
  -D JXCT_BUILD_DATE='"2025-06-10"'
  -D MQTT_MAX_PACKET_SIZE=1024
  -D MQTT_KEEPALIVE=60
  -D MQTT_SOCKET_TIMEOUT=15
  -D LED_BUILTIN=2
  -D BOOT_BUTTON=0
  ; НЕ определяем DEBUG_MODE и INFO_MODE для продакшна
  -D NDEBUG
  -Os                    ; Optimize for size
  -ffunction-sections    ; Separate functions for better linking
  -fdata-sections        ; Separate data sections for better linking
  -D CONFIG_LOG_DEFAULT_LEVEL=1   ; Minimal logging
  -D ARDUINO_LOOP_STACK_SIZE=4096 ; Smaller stack
  -D CORE_DEBUG_LEVEL=0  ; Disable Arduino Core debug
  -D DEBUG_ESP_PORT=     ; Disable ESP debug output

build_unflags = 
  -fno-exceptions       ; Remove exception handling overhead

; Advanced linker flags for dead code removal
board_build.ldflags = 
  -Wl,--gc-sections      ; Remove unused sections
  -Wl,--print-gc-sections ; Show what's being removed (optional) 