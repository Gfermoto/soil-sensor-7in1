# JXCT 7in1 Soil Sensor для ESP32

Проект для работы с датчиком почвы JXCT 7in1 на базе ESP32. Датчик измеряет температуру, влажность, электропроводность (EC), pH и содержание NPK (азот, фосфор, калий) в почве.

## Аппаратная платформа

- **Микроконтроллер**: ESP32
- **Датчик**: JXCT 7in1 (интерфейс RS485/Modbus RTU)
- **Периферия**:
  - Кнопка BOOT (GPIO0) для сброса настроек
  - Светодиод (LED) на GPIO2 для индикации статуса Wi-Fi
  - UART-интерфейс для связи с датчиком (RX: GPIO16, TX: GPIO17)
  - MAX485 для преобразования UART в RS485 (DE/RE: GPIO5)

## Функциональные возможности

- **Wi-Fi режимы**:
  - AP Mode: Создание точки доступа для настройки Wi-Fi
  - STA Mode: Подключение к сохраненной сети
- **Веб-интерфейс**:
  - Страница конфигурации с полями для SSID, пароля Wi-Fi
  - Настройки MQTT (сервер, порт, логин, пароль, топики)
  - Настройки ThingSpeak (API ключ)
- **Протоколы и сервисы**:
  - MQTT: Публикация данных датчика
  - Home Assistant: Автоматическое обнаружение через MQTT Discovery
  - ThingSpeak: Отправка данных через HTTP-запросы
- **Индикация**:
  - LED: Мигание (не подключен к Wi-Fi) → Постоянный свет (подключен)
  - Обратная связь через веб-интерфейс (статус подключения, ошибки)
- **Сброс настроек**: Удержание кнопки BOOT >5 сек → очистка настроек и переход в AP Mode

## Подключение

### Датчик JXCT 7in1

| Датчик JXCT | ESP32 | MAX485 |
|-------------|-------|--------|
| VCC         | 3.3V  | -      |
| GND         | GND   | -      |
| A           | -     | A      |
| B           | -     | B      |

### MAX485

| MAX485 | ESP32 |
|--------|-------|
| VCC    | 3.3V  |
| GND    | GND   |
| DI     | GPIO17|
| RO     | GPIO16|
| DE/RE  | GPIO5 |
| A      | A датчика |
| B      | B датчика |

## Настройка

1. Подключите ESP32 к компьютеру через USB
2. Загрузите прошивку с помощью PlatformIO
3. При первом запуске или после сброса настроек, ESP32 создаст точку доступа "JXCT_SENSOR" с паролем "12345678"
4. Подключитесь к точке доступа и откройте в браузере адрес 192.168.4.1
5. Настройте параметры Wi-Fi, MQTT и ThingSpeak
6. После сохранения настроек ESP32 перезагрузится и подключится к указанной сети

## Интеграция с Home Assistant

Датчик автоматически регистрируется в Home Assistant через MQTT Discovery. После подключения к MQTT брокеру, в Home Assistant появятся следующие сенсоры:

- Температура почвы (°C)
- Влажность почвы (%)
- Электропроводность (µS/cm)
- pH почвы
- Содержание NPK (мг/кг)

## Интеграция с ThingSpeak

Данные отправляются в ThingSpeak через HTTP-запросы. Настройте каналы в ThingSpeak следующим образом:

- Field 1: Температура (°C)
- Field 2: Влажность (%)
- Field 3: Электропроводность (µS/cm)
- Field 4: pH
- Field 5: Азот (мг/кг)
- Field 6: Фосфор (мг/кг)
- Field 7: Калий (мг/кг)

## Сборка проекта

1. Установите PlatformIO
2. Клонируйте репозиторий
3. Откройте проект в PlatformIO
4. Соберите и загрузите прошивку

```bash
pio run -t upload
```

## Лицензия

MIT 